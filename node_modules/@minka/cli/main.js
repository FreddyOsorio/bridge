#!/usr/bin/env node
(()=>{"use strict";var __webpack_modules__={1859:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.createBridge=void 0;const format_1=__webpack_require__(8861),types_1=__webpack_require__(8071),chalk_1=__importDefault(__webpack_require__(5022)),inquirer_1=__importDefault(__webpack_require__(3290)),access_1=__webpack_require__(6570),form_json_1=__webpack_require__(6841),formatting_1=__webpack_require__(1082),ledger_1=__webpack_require__(5777),signer_1=__webpack_require__(894);exports.createBridge=async function(){const{ledger}=await(0,ledger_1.assertServerConnection)(),signers=await(0,signer_1.assertSigners)(),answers=await inquirer_1.default.prompt([{type:"input",name:"handle",message:"Handle:",filter:input=>((0,format_1.assertNotEmptyString)(input),(0,format_1.assertValidIdentifier)(input),input)},{type:"list",name:"schema",message:"Schema:",default:types_1.BridgeSchemas[0],choices:types_1.BridgeSchemas,filter:selection=>((0,format_1.assertOptionsSelected)(selection,1),selection)},{type:"input",name:"server",message:"Server:",filter:input=>((0,format_1.assertNotEmptyString)(input),(0,format_1.assertValidUrl)(input),input)},{type:"confirm",name:"addCustomData",message:"Add custom data?",default:!1}]),customData=answers.addCustomData?await(0,form_json_1.promptSimpleMap)():void 0,signer=await(0,signer_1.promptSigner)(signers),signerData=signer.data,ledgerReply=await ledger.bridge.init().data({handle:answers.handle,schema:answers.schema,config:{server:answers.server,signer:{public:signerData.public,schema:signerData.schema}},secure:[],access:(0,access_1.getDefaultRecordAccess)([signerData.public]),custom:customData}).hash().sign([{keyPair:{public:signerData.public,schema:signerData.schema,secret:signerData.secret}}]).send();process.env.VERBOSE&&(0,formatting_1.printAxiosRequestAndResponse)(ledgerReply.response),console.log(),console.log(chalk_1.default.bold("✅ Bridge created successfully:")),console.log(`${chalk_1.default.bold("Handle:")} ${chalk_1.default.bold.cyan(answers.handle)}`),console.log(`${chalk_1.default.bold("Schema:")} ${chalk_1.default.bold.cyan(answers.schema)}`),console.log(`${chalk_1.default.bold("Server:")} ${chalk_1.default.bold.cyan(answers.server)}`),console.log(`${chalk_1.default.bold("Signer:")} ${chalk_1.default.bold.cyan(signerData.public)} ${chalk_1.default.bold.red(`(${signer.handle})`)}`),(0,form_json_1.printSimpleMap)("Custom",customData)}},9273:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.startBridge=void 0;const format_1=__webpack_require__(8861),types_1=__webpack_require__(8071),chalk_1=__importDefault(__webpack_require__(5022)),inquirer_1=__importDefault(__webpack_require__(3290)),ngrok_1=__importDefault(__webpack_require__(732)),error_handling_1=__webpack_require__(6418),ledger_1=__webpack_require__(5777),local_bridge_registration_1=__webpack_require__(1189),local_bridge_server_1=__webpack_require__(9398),signer_1=__webpack_require__(894);exports.startBridge=async function(options){const{ledger,config}=await(0,ledger_1.assertServerConnection)(),signers=await(0,signer_1.assertSigners)(),signer=await(0,signer_1.promptSigner)(signers),signerData=signer.data,{handle,shouldRegister}=await inquirer_1.default.prompt([{type:"confirm",name:"shouldRegister",message:"Register with ledger?",default:!0},{type:"input",name:"handle",when:({shouldRegister})=>shouldRegister,message:"Handle:",default:signer.handle,filter:input=>((0,format_1.assertNotEmptyString)(input),(0,format_1.assertValidIdentifier)(input),input)}]),port=Number(options.port),isCloudLedger=!config.url?.startsWith("http://localhost:");let publicUrl=null;if(isCloudLedger){console.log(),console.log("Cloud ledger detected, creating an ngrok tunnel...");try{publicUrl=await ngrok_1.default.connect(port),console.log(`Created ${chalk_1.default.bold.green("✔")}`)}catch(error){console.log(chalk_1.default.red`Failed to create an ngrok tunnel.`),(0,error_handling_1.printError)(error)}}const serverUrl=`http://localhost:${port}`;console.log(),console.log("Bridge is available through following URLs:"),console.log(` - Server URL: ${chalk_1.default.cyan(serverUrl)}`),isCloudLedger&&console.log(` - Public URL: ${chalk_1.default.cyan(publicUrl)}`),shouldRegister&&(console.log(),console.log(`Registering ${handle} with ledger...`),await(0,local_bridge_registration_1.registerBridge)(ledger,{handle,schema:types_1.BridgeSchema.Rest,config:{server:isCloudLedger?publicUrl:serverUrl,signer:{schema:signer.data.schema,public:signer.data.public}},secure:[],access:[{action:types_1.AccessAction.Any,signer:signer.data.public}]},{schema:signer.data.schema,public:signer.data.public,secret:signer.data.secret}),console.log(`Registered ${chalk_1.default.bold.green("✔")}`)),(0,local_bridge_server_1.startBridgeServer)(port,ledger,{schema:signerData.schema,public:signerData.public,secret:signerData.secret})}},5400:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.createEffect=void 0;const format_1=__webpack_require__(8861),types_1=__webpack_require__(8071),chalk_1=__importDefault(__webpack_require__(5022)),inquirer_1=__importDefault(__webpack_require__(3290)),access_1=__webpack_require__(6570),form_json_1=__webpack_require__(6841),formatting_1=__webpack_require__(1082),ledger_1=__webpack_require__(5777),signer_1=__webpack_require__(894),actionPrompts={[types_1.EffectActionSchema.webhook]:[{type:"input",name:"endpoint",message:"Webhook endpoint:",filter:input=>((0,format_1.assertNotEmptyString)(input),input)}]};exports.createEffect=async function(){const{ledger}=await(0,ledger_1.assertServerConnection)(),signers=await(0,signer_1.assertSigners)(),{handle,signal,addFilter}=await inquirer_1.default.prompt([{type:"input",name:"handle",message:"Handle:",filter:input=>((0,format_1.assertNotEmptyString)(input),(0,format_1.assertValidIdentifier)(input),input)},{type:"list",name:"signal",pageSize:types_1.EventSignals.length,message:"Signal:",validate:selection=>((0,format_1.assertOptionsSelected)(selection,1),!0),choices:types_1.EventSignals},{type:"confirm",name:"addFilter",message:"Add filter?",default:!1}]),filterData=addFilter?await(0,form_json_1.promptSimpleMap)():void 0,{actionSchema}=await inquirer_1.default.prompt([{type:"list",name:"actionSchema",pageSize:types_1.EffectActionSchemas.length,message:"Action schema:",validate:selection=>((0,format_1.assertOptionsSelected)(selection,1),!0),choices:types_1.EffectActionSchemas}]),actionData=await async function(schema){const prompts=actionPrompts[schema];if(!prompts)throw new Error(`Effect action schema '${schema}' is not supported`);return{schema,...await inquirer_1.default.prompt(prompts)}}(actionSchema),{addCustomData}=await inquirer_1.default.prompt([{type:"confirm",name:"addCustomData",message:"Add custom data?",default:!1}]),customData=addCustomData?await(0,form_json_1.promptSimpleMap)():void 0,signer=await(0,signer_1.promptSigner)(signers),signerData=signer.data,ledgerReply=await ledger.effect.init().data({handle,signal,filter:filterData,action:actionData,access:(0,access_1.getDefaultRecordAccess)([signerData.public]),custom:customData}).hash().sign([{keyPair:{public:signerData.public,schema:signerData.schema,secret:signerData.secret}}]).send();process.env.VERBOSE&&(0,formatting_1.printAxiosRequestAndResponse)(ledgerReply.response),console.log(),console.log(chalk_1.default.bold("✅ Effect created successfully:")),console.log(`${chalk_1.default.bold("Handle:")} ${chalk_1.default.bold.cyan(handle)}`),console.log(`${chalk_1.default.bold("Signal:")} ${chalk_1.default.bold.cyan(signal)}`),(0,form_json_1.printSimpleMap)("Filter",filterData),(0,form_json_1.printSimpleMap)("Action",actionData),console.log(`${chalk_1.default.bold("Signer:")} ${chalk_1.default.bold.cyan(signerData.public)} ${chalk_1.default.bold.red(`(${signer.handle})`)}`),(0,form_json_1.printSimpleMap)("Custom",customData)}},2920:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.createIntent=void 0;const format_1=__webpack_require__(8861),types_1=__webpack_require__(8071),chalk_1=__importDefault(__webpack_require__(5022)),inquirer_1=__importDefault(__webpack_require__(3290)),nanoid_1=__webpack_require__(754),access_1=__webpack_require__(6570),form_json_1=__webpack_require__(6841),formatting_1=__webpack_require__(1082),formatting_amount_1=__webpack_require__(9468),intent_1=__webpack_require__(692),ledger_1=__webpack_require__(5777),signer_1=__webpack_require__(894);exports.createIntent=async function(){const{ledger,config}=await(0,ledger_1.assertServerConnection)(),signers=await(0,signer_1.assertSigners)(),{handle}=await inquirer_1.default.prompt([{type:"input",name:"handle",message:"Handle:",default:(0,nanoid_1.nanoid)(17)}]),actionQuestions=[{type:"list",name:"action",message:"Action:",choices:[types_1.ClaimAction.Transfer,types_1.ClaimAction.Issue,types_1.ClaimAction.Destroy],default:0},{type:"input",name:"source",message:"Source:",when:answers=>[types_1.ClaimAction.Transfer,types_1.ClaimAction.Destroy].includes(answers.action),filter:input=>((0,format_1.assertNotEmptyString)(input),(0,format_1.assertValidIdentifier)(input,"address"),input)},{type:"input",name:"target",message:"Target:",when:answers=>[types_1.ClaimAction.Issue,types_1.ClaimAction.Transfer].includes(answers.action),filter:input=>((0,format_1.assertNotEmptyString)(input),(0,format_1.assertValidIdentifier)(input,"address"),input)},{type:"input",name:"symbol",message:"Symbol:",filter:input=>((0,format_1.assertNotEmptyString)(input),(0,format_1.assertValidIdentifier)(input),input)},{type:"number",name:"amount",message:"Amount:",filter:async(input,answers)=>{(0,format_1.assertNumber)(input),(0,format_1.assertGreaterThan)(input,0);const factor=await(0,formatting_amount_1.resolveFactor)(ledger,answers.symbol);return(0,format_1.assertValidWithFactor)(input,factor),input}},{type:"confirm",name:"addAction",message:"Add another action?",default:!1}],claims=[];for(;;){const answers=await inquirer_1.default.prompt(actionQuestions),claim={...answers,amount:(0,format_1.toLedgerAmount)(answers.amount,await(0,formatting_amount_1.resolveFactor)(ledger,answers.symbol))};if(claims.push(claim),!answers.addAction)break}const{addCustomData}=await inquirer_1.default.prompt([{type:"confirm",name:"addCustomData",message:"Add custom data?",default:!1}]),customData=addCustomData?await(0,form_json_1.promptSimpleMap)():void 0,intentSigners=await(0,signer_1.promptSigners)(signers),intentData={handle,claims:claims.map((claim=>({action:claim.action,source:claim.source,target:claim.target,symbol:claim.symbol,amount:claim.amount}))),custom:customData};await(0,intent_1.printIntent)(ledger,intentData);const signersInfo=(0,format_1.formatList)(intentSigners.map((signer=>chalk_1.default.red(signer.handle))));console.log();const{confirmed}=await inquirer_1.default.prompt([{type:"confirm",name:"confirmed",message:`Sign this intent using ${(0,format_1.pluralize)(intentSigners.length,"signer")} ${signersInfo}?`,default:!1}]);if(!confirmed)return console.log(),void console.log(chalk_1.default.bold.red("Operation cancelled."));const signingParams=intentSigners.map((signer=>({keyPair:{public:signer.data.public,schema:signer.data.schema,secret:signer.data.secret}}))),ledgerReply=await ledger.intent.init().data({...intentData,access:(0,access_1.getDefaultRecordAccess)(signingParams.map((p=>p.keyPair.public)))}).hash().sign(signingParams).send();process.env.VERBOSE&&(0,formatting_1.printAxiosRequestAndResponse)(ledgerReply.response),console.log(),console.log(chalk_1.default.bold(`✅ Intent signed and sent to ledger ${chalk_1.default.cyan(config.ledger)}`)),console.log(chalk_1.default.bold`Intent status: ${(0,intent_1.formatIntentStatus)(ledgerReply.meta.status)}`)}},6853:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.showIntentList=void 0;const chalk_1=__importDefault(__webpack_require__(5022)),formatting_1=__webpack_require__(1082),intent_1=__webpack_require__(692),ledger_1=__webpack_require__(5777),pagination_1=__webpack_require__(2180);async function showIntentListPage(ledger,index=0,limit=10){const{response,page}=await ledger.intent.list({page:{index,limit}});if(process.env.VERBOSE&&(0,formatting_1.printAxiosRequestAndResponse)(response),console.log(),!response?.data?.data||0===response.data.data.length)return void console.log(chalk_1.default.red.bold`No records found`);const intents=response.data.data;await(0,intent_1.printIntentList)(ledger,intents);const nextAction=await(0,pagination_1.promptPagination)(page);"q"!==nextAction&&("n"===nextAction?await showIntentListPage(ledger,index+1,limit):"p"===nextAction&&await showIntentListPage(ledger,index-1,limit))}exports.showIntentList=async function(options){const{ledger}=await(0,ledger_1.assertServerConnection)(),index=Number(options.page),limit=Number(options.limit);await showIntentListPage(ledger,index,limit)}},9684:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.showIntent=void 0;const formatting_1=__webpack_require__(1082),intent_1=__webpack_require__(692),ledger_1=__webpack_require__(5777);exports.showIntent=async function(handle){const{ledger}=await(0,ledger_1.assertServerConnection)(),{intent,response}=await ledger.intent.read(handle);process.env.VERBOSE&&(0,formatting_1.printAxiosRequestAndResponse)(response),await(0,intent_1.printIntent)(ledger,intent,response.data.meta)}},3789:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.createLedgerInstance=void 0;const format_1=__webpack_require__(8861),chalk_1=__importDefault(__webpack_require__(5022)),inquirer_1=__importDefault(__webpack_require__(3290)),ledger_access_1=__webpack_require__(7425),editor_json_1=__webpack_require__(6110),form_json_1=__webpack_require__(6841),formatting_1=__webpack_require__(1082),ledger_1=__webpack_require__(5777),signer_1=__webpack_require__(894);exports.createLedgerInstance=async function(){const{ledger}=await(0,ledger_1.assertServerConnection)(),signers=await(0,signer_1.assertSigners)();if((await ledger.instance.list()).instances.length)throw console.log(),new Error("The active server cannot hold multiple ledger instances.");const{handle}=await inquirer_1.default.prompt([{type:"input",name:"handle",message:"Handle:",filter:input=>((0,format_1.assertNotEmptyString)(input),(0,format_1.assertValidIdentifier)(input),input)}]),access=await(0,editor_json_1.promptJsonEditor)({name:"access",default:[],schema:ledger_access_1.LedgerAccessSchema}),{addCustomData}=await inquirer_1.default.prompt([{type:"confirm",name:"addCustomData",message:"Add custom data?",default:!1}]),customData=addCustomData?await(0,form_json_1.promptSimpleMap)():void 0,signer=await(0,signer_1.promptSigner)(signers),signerData=signer.data,newLedgerData={handle,access,signer:null,custom:customData};console.log(),(0,ledger_1.printLedgerInstance)("Ledger summary:",newLedgerData),console.log(),console.log(chalk_1.default.bold(chalk_1.default.yellow("⚠️  To allow a new ledger instance to sign specific operations\nwhen needed, a new signer will be created and attached to it.\nThis new signer will be owned and managed by the server.\nIts public key and key schema are going to be available\nfor verification of the signature.\n       "))),console.log();const{confirmed}=await inquirer_1.default.prompt([{type:"confirm",name:"confirmed",message:`Sign this ledger instance using signer ${chalk_1.default.red(signer.handle)}?`,default:!1}]);if(!confirmed)return console.log(),void console.log(chalk_1.default.bold.red("Operation cancelled."));const ledgerSigner=await ledger.signer.init().hash().send();newLedgerData.signer=ledgerSigner.signer.handle;const ledgerReply=await ledger.instance.init().data(newLedgerData).hash().sign([{keyPair:{public:signerData.public,schema:signerData.schema,secret:signerData.secret}}]).send();process.env.VERBOSE&&(0,formatting_1.printAxiosRequestAndResponse)(ledgerReply.response),console.log(),console.log(chalk_1.default.bold("✅ Ledger instance created successfully:")),console.log(`${chalk_1.default.bold("Handle:")} ${chalk_1.default.bold.cyan(handle)}`),console.log(`${chalk_1.default.bold("Public:")} ${chalk_1.default.bold.cyan(ledgerSigner.signer.public)}`),console.log(`${chalk_1.default.bold("Signer:")} ${chalk_1.default.bold.cyan(signerData.public)} ${chalk_1.default.bold.red(`(${signer.handle})`)}`),(0,form_json_1.printSimpleMap)("Custom",customData)}},9151:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ledgerLogin=void 0;const chalk_1=__importDefault(__webpack_require__(5022)),inquirer_1=__importDefault(__webpack_require__(3290)),ledger_1=__webpack_require__(5777),signer_1=__webpack_require__(894),authentication_1=__webpack_require__(8727);exports.ledgerLogin=async function(){await(0,ledger_1.assertServerConnection)();const signers=await(0,signer_1.assertSigners)(),userLoggedIn=await(0,authentication_1.getUserLoggedIn)();if(userLoggedIn){console.log(),console.log(`It seems you're currently logged in with ${chalk_1.default.cyan(userLoggedIn.handle)}`),console.log("and you'll be logged out if you proceed with login"),console.log();const{confirm}=await inquirer_1.default.prompt([{type:"confirm",name:"confirm",message:"Do you want to proceed?",default:!1}]);if(!confirm)return console.log(),void console.log(chalk_1.default.bold.red("Operation cancelled."));await(0,authentication_1.logout)()}const user=await async function(signers){const signer=await(0,signer_1.promptSigner)(signers);return{handle:signer.handle,public:signer.data.public,secret:signer.data.secret,schema:signer.data.schema}}(signers);await(0,authentication_1.login)(user),console.log(),console.log(chalk_1.default.bold(`✅ Logged in to ledger with ${chalk_1.default.cyan(user.handle)}`))}},6557:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ledgerLogout=void 0;const chalk_1=__importDefault(__webpack_require__(5022)),inquirer_1=__importDefault(__webpack_require__(3290)),authentication_1=__webpack_require__(8727);exports.ledgerLogout=async function(){const userLoggedIn=await(0,authentication_1.getUserLoggedIn)();if(console.log(),!userLoggedIn)return void console.log(`Not logged in to a ledger, please log in to ledger by running:\n${chalk_1.default.cyan(" > minka ledger login")}`);console.log(`Currently logged in with ${chalk_1.default.cyan(userLoggedIn.handle)}`),console.log();const{confirm}=await inquirer_1.default.prompt([{type:"confirm",name:"confirm",message:"Confirm logout?",default:!1}]);if(!confirm)return console.log(),void console.log(chalk_1.default.bold.red("Operation cancelled."));await(0,authentication_1.logout)()}},8570:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.showLedger=void 0;const chalk_1=__importDefault(__webpack_require__(5022)),formatting_1=__webpack_require__(1082),ledger_1=__webpack_require__(5777);exports.showLedger=async function(){const{ledger}=await(0,ledger_1.assertServerConnection)(),{instances,response}=await ledger.instance.list(),activeLedger=instances[0];process.env.VERBOSE&&(0,formatting_1.printAxiosRequestAndResponse)(response),console.log(),activeLedger?(0,ledger_1.printLedgerInstance)("Active ledger:",activeLedger):console.log(chalk_1.default.red.bold("Ledger not configured."))}},8449:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.connectToServer=void 0;const ledger_sdk_1=__webpack_require__(1276),chalk_1=__importDefault(__webpack_require__(5022)),inquirer_1=__importDefault(__webpack_require__(3290)),authentication_1=__webpack_require__(8727),ledger_1=__webpack_require__(5777);exports.connectToServer=async function(){const{url,ledger}=await inquirer_1.default.prompt([{type:"input",name:"url",message:"URL:",validate:async(url,answers)=>{try{const ledger=new ledger_sdk_1.LedgerSdk({url}),{response,status}=await ledger.status();return 200!==response.status?`Unable to connect to server, HTTP status code: ${response.status}`:status?.ledger?(answers.ledger=status.ledger,!0):"Unable to verify server instance, did you enter the server root URL?"}catch(error){return error.message}}}]);await(0,authentication_1.getUserLoggedIn)()&&await(0,authentication_1.logout)(),await(0,ledger_1.saveServerConfig)({url,ledger}),console.log(),console.log(chalk_1.default.bold(`✅ Connected to server ${chalk_1.default.cyan(ledger)} ${chalk_1.default.gray(`(${url})`)}`))}},7616:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.showServer=void 0;const chalk_1=__importDefault(__webpack_require__(5022)),ledger_1=__webpack_require__(5777);exports.showServer=async function(){const{config}=await(0,ledger_1.assertServerConnection)(),{ledger,url}=config;console.log(),console.log(chalk_1.default.bold(`✅ Connected to server ${chalk_1.default.cyan(ledger)} ${chalk_1.default.gray(`(${url})`)}`))}},5262:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.createSigner=void 0;const format_1=__webpack_require__(8861),chalk_1=__importDefault(__webpack_require__(5022)),inquirer_1=__importDefault(__webpack_require__(3290)),lodash_1=__importDefault(__webpack_require__(6517)),access_1=__webpack_require__(6570),form_json_1=__webpack_require__(6841),formatting_1=__webpack_require__(1082),ledger_1=__webpack_require__(5777),signer_1=__webpack_require__(894);exports.createSigner=async function(){const{ledger}=await(0,ledger_1.assertServerConnection)(),[deviceSigners,remoteSigners]=await Promise.all([(0,signer_1.loadDeviceSigners)(),(0,signer_1.loadRemoteSigners)()]),{handle,addCustomData}=await inquirer_1.default.prompt([{type:"input",name:"handle",message:"Handle:",filter:async input=>{if((0,format_1.assertNotEmptyString)(input),(0,format_1.assertValidIdentifier)(input),remoteSigners[input]||deviceSigners[input])throw new Error("Signer with this handle already exists!");return input}},{type:"confirm",name:"addCustomData",message:"Add custom data?",default:!1}]),customData=addCustomData?await(0,form_json_1.promptSimpleMap)():void 0,{storeToLedger}=await inquirer_1.default.prompt([{type:"confirm",name:"storeToLedger",message:"Store to ledger?",default:!1}]),signer=ledger.signer.init().data({handle,custom:customData}).keys({schema:"ed25519"}),{data}=await signer.read({plain:!0}),keyPair=lodash_1.default.pick(data,["public","secret","schema"]);if(storeToLedger){const keyPassword=await async function(){for(;;){const{keyPassword,repeatedPassword}=await inquirer_1.default.prompt([{type:"password",name:"keyPassword",message:"Key password:",filter:async input=>((0,format_1.assertNotEmptyString)(input),input)},{type:"password",name:"repeatedPassword",message:"Repeat password:",filter:async input=>((0,format_1.assertNotEmptyString)(input),input)}]);if(keyPassword===repeatedPassword)return keyPassword;console.log(chalk_1.default.bold.red("Password mismatch. Try Again."))}}(),ledgerReply=await signer.code(keyPassword).data({access:(0,access_1.getDefaultRecordAccess)([keyPair.public])}).hash().lock().send();process.env.VERBOSE&&(0,formatting_1.printAxiosRequestAndResponse)(ledgerReply.response)}else await(0,signer_1.saveDeviceSigner)(handle,keyPair,customData);console.log(),console.log(chalk_1.default.bold("✅ Signer created successfully:")),console.log(`${chalk_1.default.bold("Handle:")} ${chalk_1.default.bold.cyan(handle)}`),console.log(`${chalk_1.default.bold("Public:")} ${chalk_1.default.bold.cyan(keyPair.public)}`),console.log(`${chalk_1.default.bold("Secret:")} ${chalk_1.default.italic.gray("[value is hidden]")}`),(0,form_json_1.printSimpleMap)("Custom",customData),storeToLedger&&console.log(chalk_1.default.bold("✅ Signer stored to ledger")),console.log(),console.log(chalk_1.default.yellow("⚠️  WARNING: Secret or private key is critical data that should be handled\nwith care. Private keys are used to modify balances and it is important to\nunderstand that anyone who has access to that key can perform sensitive\nledger operations."))}},7367:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.createSymbol=void 0;const format_1=__webpack_require__(8861),chalk_1=__importDefault(__webpack_require__(5022)),inquirer_1=__importDefault(__webpack_require__(3290)),access_1=__webpack_require__(6570),form_json_1=__webpack_require__(6841),formatting_1=__webpack_require__(1082),ledger_1=__webpack_require__(5777),signer_1=__webpack_require__(894);exports.createSymbol=async function(){const{ledger}=await(0,ledger_1.assertServerConnection)(),signers=await(0,signer_1.assertSigners)(),answers=await inquirer_1.default.prompt([{type:"input",name:"handle",message:"Handle:",filter:input=>((0,format_1.assertNotEmptyString)(input),(0,format_1.assertValidIdentifier)(input),input)},{type:"number",name:"factor",message:"Factor:",default:100,filter:input=>((0,format_1.assertNumber)(input),(0,format_1.assertGreaterThanOrEqual)(input,1),(0,format_1.assertLessThanOrEqual)(input,1e15),(0,format_1.assertPowerOf10)(input),input)},{type:"confirm",name:"addCustomData",message:"Add custom data?",default:!1}]),customData=answers.addCustomData?await(0,form_json_1.promptSimpleMap)():void 0,signer=await(0,signer_1.promptSigner)(signers),signerData=signer.data,ledgerReply=await ledger.symbol.init().data({handle:answers.handle,factor:answers.factor,access:(0,access_1.getDefaultRecordAccess)([signerData.public]),custom:customData}).hash().sign([{keyPair:{public:signerData.public,schema:signerData.schema,secret:signerData.secret}}]).send();process.env.VERBOSE&&(0,formatting_1.printAxiosRequestAndResponse)(ledgerReply.response),console.log(),console.log(chalk_1.default.bold("✅ Symbol created successfully:")),console.log(`${chalk_1.default.bold("Handle:")} ${chalk_1.default.bold.cyan(answers.handle)}`),console.log(`${chalk_1.default.bold("Factor:")} ${chalk_1.default.bold.cyan(answers.factor)}`),console.log(`${chalk_1.default.bold("Signer:")} ${chalk_1.default.bold.cyan(signerData.public)} ${chalk_1.default.bold.red(`(${signer.handle})`)}`),(0,form_json_1.printSimpleMap)("Custom",customData)}},4216:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getWalletBalances=void 0;const format_1=__webpack_require__(8861),chalk_1=__importDefault(__webpack_require__(5022)),formatting_1=__webpack_require__(1082),formatting_amount_1=__webpack_require__(9468),ledger_1=__webpack_require__(5777);exports.getWalletBalances=async function(handle){(0,format_1.assertValidIdentifier)(handle,"address");const{ledger}=await(0,ledger_1.assertServerConnection)(),{balances,response}=await ledger.wallet.getBalances(handle);if(process.env.VERBOSE&&(0,formatting_1.printAxiosRequestAndResponse)(response),console.log(chalk_1.default.bold("Balances:")),balances&&0!==balances.length)for(const balance of balances){const amount=await(0,formatting_amount_1.formatAmount)(ledger,balance.amount,balance.symbol),symbol=chalk_1.default.bold(`(${balance.symbol})`);console.log(`${chalk_1.default.bold.green(amount)} ${symbol}`)}else console.log(chalk_1.default.red("No balances found"))}},350:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.createWallet=void 0;const chalk_1=__importDefault(__webpack_require__(5022)),inquirer_1=__importDefault(__webpack_require__(3290)),access_1=__webpack_require__(6570),form_json_1=__webpack_require__(6841),form_route_1=__webpack_require__(3228),formatting_1=__webpack_require__(1082),ledger_1=__webpack_require__(5777),signer_1=__webpack_require__(894),wallet_1=__webpack_require__(4140);exports.createWallet=async function(){const{ledger}=await(0,ledger_1.assertServerConnection)(),signers=await(0,signer_1.assertSigners)(),answers=await inquirer_1.default.prompt([wallet_1.handleInquirerQuestion,wallet_1.bridgeInquirerQuestion,form_json_1.addCustomDataInquirerQuestion]),customData=answers.addCustomData?await(0,form_json_1.promptSimpleMap)():void 0,routes=await(0,form_route_1.shouldAddRoutes)()?await(0,form_route_1.promptRoutes)():void 0,signer=await(0,signer_1.promptSigner)(signers),signerData=signer.data,ledgerReply=await ledger.wallet.init().data({handle:answers.handle,bridge:answers.bridge.length?answers.bridge:void 0,access:(0,access_1.getDefaultRecordAccess)([signerData.public]),custom:customData,routes}).hash().sign([{keyPair:{public:signerData.public,schema:signerData.schema,secret:signerData.secret}}]).send();process.env.VERBOSE&&(0,formatting_1.printAxiosRequestAndResponse)(ledgerReply.response),console.log(),console.log(chalk_1.default.bold("✅ Wallet created successfully:")),console.log(`${chalk_1.default.bold("Handle:")} ${chalk_1.default.bold.cyan(answers.handle)}`),answers.bridge.length&&console.log(`${chalk_1.default.bold("Bridge:")} ${chalk_1.default.bold.cyan(answers.bridge)}`),console.log(`${chalk_1.default.bold("Signer:")} ${chalk_1.default.bold.cyan(signerData.public)} ${chalk_1.default.bold.red(`(${signer.handle})`)}`),(0,form_json_1.printSimpleMap)("Custom",customData)}},7544:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.showWalletList=void 0;const chalk_1=__importDefault(__webpack_require__(5022)),formatting_1=__webpack_require__(1082),ledger_1=__webpack_require__(5777),pagination_1=__webpack_require__(2180),wallet_1=__webpack_require__(4140);async function showWalletListPage(ledger,index=0,limit=10){const{wallets,response,page}=await ledger.wallet.list({page:{index,limit}});if(process.env.VERBOSE&&(0,formatting_1.printAxiosRequestAndResponse)(response),console.log(),!wallets||0===wallets.length)return void console.log(chalk_1.default.red`No records found.`);(0,wallet_1.printWalletList)(wallets);const nextAction=await(0,pagination_1.promptPagination)(page);"q"!==nextAction&&("n"===nextAction?await showWalletListPage(ledger,index+1,limit):"p"===nextAction&&await showWalletListPage(ledger,index-1,limit))}exports.showWalletList=async function(options){const{ledger}=await(0,ledger_1.assertServerConnection)(),index=Number(options.page),limit=Number(options.limit);await showWalletListPage(ledger,index,limit)}},2921:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.showWallet=void 0;const formatting_1=__webpack_require__(1082),ledger_1=__webpack_require__(5777),wallet_1=__webpack_require__(4140);exports.showWallet=async function(handle){const{ledger}=await(0,ledger_1.assertServerConnection)(),{wallet,response}=await ledger.wallet.read(handle);process.env.VERBOSE&&(0,formatting_1.printAxiosRequestAndResponse)(response),(0,wallet_1.printWallet)(wallet)}},1900:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.updateWallet=void 0;const chalk_1=__importDefault(__webpack_require__(5022)),lodash_1=__webpack_require__(6517),formatting_1=__webpack_require__(1082),ledger_1=__webpack_require__(5777),signer_1=__webpack_require__(894),wallet_1=__webpack_require__(4140);exports.updateWallet=async function(handle,options){const{ledger}=await(0,ledger_1.assertServerConnection)(),{hash,wallet,response}=await ledger.wallet.read(handle);(0,wallet_1.printWallet)(wallet);const currentData={...wallet,parent:hash};let newData={...currentData};if(newData=options.editor?await(0,wallet_1.editWallet)(newData,hash):await(0,wallet_1.promptUpdateWallet)(newData),(0,lodash_1.isEqual)(newData,currentData))return console.log(),void console.log(chalk_1.default.bold.red("No changes detected, aborting the operation."));const signers=await(0,signer_1.assertSigners)(),signer=await(0,signer_1.promptSigner)(signers),signerData=signer.data,ledgerReply=await ledger.wallet.from(response.data).data(newData,!0).hash().sign([{keyPair:{public:signerData.public,schema:signerData.schema,secret:signerData.secret}}]).send();process.env.VERBOSE&&(0,formatting_1.printAxiosRequestAndResponse)(ledgerReply.response),console.log(),console.log(chalk_1.default.bold("✅ Wallet updated successfully:")),console.log(`${chalk_1.default.bold("Handle:")} ${chalk_1.default.bold.cyan(newData.handle)}`),console.log(`${chalk_1.default.bold("Signer:")} ${chalk_1.default.bold.cyan(signerData.public)} ${chalk_1.default.bold.red(`(${signer.handle})`)}`)}},2885:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&!("get"in desc?!m.__esModule:desc.writable||desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.USER_LOGGED_IN_FILE=exports.SIGNERS_FILE=exports.SERVER_CONFIG_FILE=exports.CONFIG_ROOT=void 0;const os=__importStar(__webpack_require__(2037));exports.CONFIG_ROOT=os.homedir()+"/.minka",exports.SERVER_CONFIG_FILE=`${exports.CONFIG_ROOT}/server.json`,exports.SIGNERS_FILE=`${exports.CONFIG_ROOT}/signers.json`,exports.USER_LOGGED_IN_FILE=`${exports.CONFIG_ROOT}/user.json`},7425:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.LedgerAccessSchema=void 0;const joi_1=__importDefault(__webpack_require__(8506)),action=joi_1.default.string().valid("any","access","create","read","update").required(),bearerRule=joi_1.default.object({iss:joi_1.default.string(),sub:joi_1.default.string(),aud:joi_1.default.string(),hsh:joi_1.default.bool().strict(),$key:joi_1.default.string()}),bearerAggregation=joi_1.default.object({$in:joi_1.default.array().items(bearerRule)}),bearer=joi_1.default.alternatives().try(bearerRule,bearerAggregation),record=joi_1.default.string().valid("any","ledger","symbol","wallet","intent","effect","signer","bridge"),signerRule=joi_1.default.string(),signerAggregation=joi_1.default.object({$in:joi_1.default.array().items(signerRule)}),signer=joi_1.default.alternatives().try(signerRule,signerAggregation);exports.LedgerAccessSchema=joi_1.default.array().items(joi_1.default.object({record,action,signer,bearer}))},6954:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.createWalletUpdateSchema=exports.RoutesSchema=void 0;const joi_1=__importDefault(__webpack_require__(8506)),accessRule=joi_1.default.object().keys({action:joi_1.default.string().required(),filter:joi_1.default.object(),signer:joi_1.default.string(),bearer:joi_1.default.object().keys({iss:joi_1.default.string(),sub:joi_1.default.string(),aud:joi_1.default.string(),hsh:joi_1.default.boolean()})}),route=joi_1.default.object().keys({filter:joi_1.default.object(),action:joi_1.default.string().required().valid("forward"),target:joi_1.default.string().required()});exports.RoutesSchema=joi_1.default.array().items(route),exports.createWalletUpdateSchema=function(handle,previousHash){return joi_1.default.object({handle:joi_1.default.string().required().valid(handle),parent:joi_1.default.string().required().valid(previousHash),bridge:joi_1.default.string(),custom:joi_1.default.object(),routes:exports.RoutesSchema,access:joi_1.default.array().required().items(accessRule)})}},6570:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.formatAccessSummary=exports.editAccess=exports.getDefaultRecordAccess=void 0;const types_1=__webpack_require__(8071),chalk_1=__importDefault(__webpack_require__(5022)),lodash_1=__webpack_require__(6517),ledger_access_1=__webpack_require__(7425),editor_json_1=__webpack_require__(6110);exports.getDefaultRecordAccess=recordSigners=>{let signer,bearer;return 1===recordSigners.length?(signer=recordSigners[0],bearer={sub:recordSigners[0]}):(signer={$in:recordSigners},bearer={$in:recordSigners.map((recordSigner=>({sub:recordSigner})))}),[{action:types_1.AccessAction.Any,signer},{action:types_1.AccessAction.Any,bearer}]},exports.editAccess=async function(access){return await(0,editor_json_1.promptJsonEditor)({name:"access",default:access,schema:ledger_access_1.LedgerAccessSchema})},exports.formatAccessSummary=function(access){return access&&0!==access.length?(0,lodash_1.isArray)(access)?access.some((rule=>rule.action===types_1.AccessAction.Any&&!rule.bearer&&!rule.signer))?chalk_1.default.red`Public`:access.every((rule=>rule.bearer||rule.signer))?chalk_1.default.green`Secure`:chalk_1.default.yellowBright`Unknown`:chalk_1.default.yellowBright`Outdated`:chalk_1.default.bgRed` Locked `}},8727:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.logout=exports.login=exports.getUserLoggedIn=void 0;const fs_extra_1=__importDefault(__webpack_require__(4470)),config_1=__webpack_require__(2885);exports.getUserLoggedIn=async function(){await fs_extra_1.default.ensureFile(config_1.USER_LOGGED_IN_FILE);try{return await fs_extra_1.default.readJSON(config_1.USER_LOGGED_IN_FILE)}catch(error){return null}},exports.login=async function(user){await fs_extra_1.default.ensureFile(config_1.USER_LOGGED_IN_FILE),await fs_extra_1.default.writeJSON(config_1.USER_LOGGED_IN_FILE,user,{spaces:2})},exports.logout=async function(){await fs_extra_1.default.writeJSON(config_1.USER_LOGGED_IN_FILE,null)}},6110:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.promptJsonEditor=void 0;const inquirer_1=__importDefault(__webpack_require__(3290));exports.promptJsonEditor=async function(options){const message=options?.name?`Enter ${options.name} content:`:"Enter content:",{response}=await inquirer_1.default.prompt([{type:"editor",name:"response",postfix:"json",message,validate:async input=>{let content;try{content=JSON.parse(input)}catch(err){throw new Error("The content is not a valid JSON.")}return options?.schema&&await options.schema.validateAsync(content),options?.validator&&await options.validator(content),!0},default:JSON.stringify(options?.default||{},null,2)}]);return JSON.parse(response)}},6418:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.printError=void 0;const ledger_sdk_1=__webpack_require__(1276),axios_1=__webpack_require__(2167),chalk_1=__importDefault(__webpack_require__(5022)),formatting_1=__webpack_require__(1082);function printStackTrace(error){console.log(),console.log(chalk_1.default.bold("Stack trace:")),console.log(error.stack)}exports.printError=function(error){const trace=process.env.TRACE,verbose=process.env.VERBOSE;if(!(error instanceof ledger_sdk_1.LedgerSdkError))return trace&&printStackTrace(error),void console.log(chalk_1.default.bold.red(`Unexpected error: ${error.message}`));if(verbose&&error.detail){const causedBy=error.detail.causedBy;causedBy instanceof axios_1.AxiosError&&((0,formatting_1.printAxiosRequestAndResponse)(causedBy.response),console.log()),trace&&(console.log(`${chalk_1.default.bold.red("Error details: ")}`),console.log(JSON.stringify(error.detail,null,2)))}trace&&printStackTrace(error),console.log(),console.log(`${chalk_1.default.bold("Status: ")}${chalk_1.default.cyan(error.status)}`),console.log(chalk_1.default.red(error.reason))}},7691:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.printAccessRules=void 0;const chalk_1=__importDefault(__webpack_require__(5022)),lodash_1=__importDefault(__webpack_require__(6517));function isAggregationRule(rule){return void 0!==rule.$in}function printBearerRule(bearerRule,isAggregation=!1){const spaces="".padStart(isAggregation?4:0," ");let isFirstPropertyFilled=!0;const getPrefix=()=>isAggregation?`${spaces}${isFirstPropertyFilled?"-":" "}`:`${spaces}-`;bearerRule.iss&&(console.log(`    ${getPrefix()} iss: ${chalk_1.default.cyan(bearerRule.iss)}`),isFirstPropertyFilled=!1),bearerRule.sub&&(console.log(`    ${getPrefix()} sub: ${chalk_1.default.cyan(bearerRule.sub)}`),isFirstPropertyFilled=!1),bearerRule.aud&&(console.log(`    ${getPrefix()} aud: ${chalk_1.default.cyan(bearerRule.aud)}`),isFirstPropertyFilled=!1),bearerRule.$key&&(console.log(`   ${getPrefix()} $key: ${chalk_1.default.cyan(bearerRule.$key)}`),isFirstPropertyFilled=!1),lodash_1.default.isUndefined(bearerRule.hsh)||(console.log(`    ${getPrefix()} hsh: ${chalk_1.default.cyan(bearerRule.hsh)}`),isFirstPropertyFilled=!1)}exports.printAccessRules=function(title,access){if(access&&!(access.length<1)){console.log(`${chalk_1.default.bold(title)}:`);for(let i=0;i<access.length;i++){const rule=access[i];if(console.log(chalk_1.default.gray(`#${i}`)),rule.action&&console.log(`  - Action: ${chalk_1.default.cyan(rule.action)}`),rule.record&&console.log(`  - Record: ${chalk_1.default.cyan(rule.record)}`),rule.signer)if(isAggregationRule(rule.signer)){if(console.log("  - Signer:"),rule.signer.$in?.length){console.log("   - $in:");for(const[,innerSignerRule]of rule.signer.$in.entries())console.log(`   - ${chalk_1.default.cyan(innerSignerRule)}`)}}else console.log(`  - Signer: ${chalk_1.default.cyan(rule.signer)}`);if(rule.bearer)if(console.log("  - Bearer:"),isAggregationRule(rule.bearer)){if(rule.bearer.$in?.length){console.log("    - $in:");for(const[,innerBearerRule]of rule.bearer.$in.entries())printBearerRule(innerBearerRule,!0)}}else printBearerRule(rule.bearer)}}}},5839:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.printFilter=exports.promptFilter=void 0;const format_1=__webpack_require__(8861),chalk_1=__importDefault(__webpack_require__(5022)),inquirer_1=__importDefault(__webpack_require__(3290));exports.promptFilter=async function(schema){const keys=Object.keys(schema),result={};for(;;){const answers=await inquirer_1.default.prompt([{type:"list",name:"field",message:"Field:",choices:keys,default:keys[0]},{type:"input",name:"value",message:"Value:",when:answers=>"string"===schema[answers.field]},{type:"number",name:"value",message:"Value:",when:answers=>"number"===schema[answers.field],filter:input=>((0,format_1.assertNumber)(input),input)},{type:"list",name:"value",message:"Value:",choices:["true","false"],when:answers=>"boolean"===schema[answers.field],filter:input=>Boolean(input)},{type:"confirm",name:"addMore",message:"Add another condition?",default:!1}]);if(result[answers.field]=answers.value,!answers.addMore)break}return result},exports.printFilter=function(title,data){const entries=Object.entries(data||{});if(0!==entries.length){title&&console.log(`${title}:`);for(const entry of entries)console.log(`    - ${entry[0]}: ${chalk_1.default.cyan(entry[1])}`)}}},6841:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.formatSimpleMap=exports.printSimpleMap=exports.promptSimpleMap=exports.addCustomDataInquirerQuestion=void 0;const format_1=__webpack_require__(8861),chalk_1=__importDefault(__webpack_require__(5022)),inquirer_1=__importDefault(__webpack_require__(3290));exports.addCustomDataInquirerQuestion={type:"confirm",name:"addCustomData",message:"Add custom data?",default:!1},exports.promptSimpleMap=async function(){const result={};for(;;){const answers=await inquirer_1.default.prompt([{type:"list",name:"fieldClass",message:"Field class:",choices:["string","number","boolean"],default:"string"},{type:"input",name:"fieldTitle",message:"Field title:",filter:input=>((0,format_1.assertNotEmptyString)(input),(0,format_1.assertValidIdentifier)(input,"camelCase"),input)},{type:"input",name:"fieldValue",message:"Field value:",when:answers=>"string"===answers.fieldClass},{type:"number",name:"fieldValue",message:"Field value:",when:answers=>"number"===answers.fieldClass,filter:input=>((0,format_1.assertNumber)(input),input)},{type:"list",name:"fieldValue",message:"Field value:",choices:["true","false"],when:answers=>"boolean"===answers.fieldClass,filter:input=>Boolean(input)},{type:"confirm",name:"addMoreFields",message:"Add another field?",default:!1}]);if(result[answers.fieldTitle]=answers.fieldValue,!answers.addMoreFields)break}return result},exports.printSimpleMap=function(title,data){const entries=Object.entries(data||{});if(0!==entries.length){console.log(chalk_1.default.bold(`${title}:`));for(const entry of entries)console.log(`  - ${entry[0]}: ${chalk_1.default.cyan(entry[1])}`)}},exports.formatSimpleMap=function(data){const entries=Object.entries(data||{});if(0===entries.length)return"";const itemsToShow=entries.length>2?2:entries.length,lines=[];for(let i=0;i<itemsToShow;i++){const entry=entries[i];lines.push(`${entry[0]}: ${chalk_1.default.cyan(entry[1])}`)}const remainingItems=entries.length-itemsToShow;return remainingItems>0&&lines.push(chalk_1.default.gray`${remainingItems} more ${(0,format_1.pluralize)(remainingItems,"field")}`),lines.join("\n")}},3228:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.formatRouteSummary=exports.printRoute=exports.printRoutes=exports.promptRoute=exports.editRoutes=exports.promptRoutes=exports.shouldAddRoutes=void 0;const format_1=__webpack_require__(8861),types_1=__webpack_require__(8071),chalk_1=__importDefault(__webpack_require__(5022)),inquirer_1=__importDefault(__webpack_require__(3290)),wallet_update_1=__webpack_require__(6954),editor_json_1=__webpack_require__(6110),form_1=__webpack_require__(3330),form_filter_1=__webpack_require__(5839);async function promptRoute(){const route={action:types_1.WalletRouteAction.Forward},{setFilter}=await inquirer_1.default.prompt([{type:"confirm",name:"setFilter",message:"Set route filter?",default:!0}]);if(setFilter){const routeFilter=await(0,form_filter_1.promptFilter)({symbol:"string",source:"string",target:"string",amount:"number"});route.filter=routeFilter}const{action,target}=await inquirer_1.default.prompt([{type:"list",name:"action",message:"Route action:",choices:["forward","accept"],default:"forward"},{type:"input",name:"target",message:"Route target:",when:answers=>"forward"===answers.action,filter:input=>((0,format_1.assertNotEmptyString)(input),(0,format_1.assertValidIdentifier)(input,"address"),input)}]);return route.action=action,route.target=target,route}function printRoute(title,route){title&&console.log(chalk_1.default.gray(`${title}`)),(0,form_filter_1.printFilter)("  - Filter",route.filter),console.log(`  - Action: ${chalk_1.default.cyan(route.action)}`),route.target&&console.log(`  - Target: ${chalk_1.default.cyan(route.target)}`)}exports.shouldAddRoutes=async function(){const{addRoutes}=await inquirer_1.default.prompt([{type:"confirm",name:"addRoutes",message:"Add routes?",default:!1}]);return addRoutes},exports.promptRoutes=async function(){const routes=[];for(;;){const route=await promptRoute();routes.push(route);if(!await(0,form_1.shouldAddMore)("Add another route?"))break}return routes},exports.editRoutes=async function(routes){return(0,editor_json_1.promptJsonEditor)({name:"routes",default:routes||[],schema:wallet_update_1.RoutesSchema})},exports.promptRoute=promptRoute,exports.printRoutes=function(title,routes){if(routes&&0!==routes.length){title&&console.log(chalk_1.default.bold(`${title}:`));for(let i=0;i<routes.length;i++)printRoute(`#${i}`,routes[i])}},exports.printRoute=printRoute,exports.formatRouteSummary=function(routes){return!routes||routes.length<=0?chalk_1.default.italic.gray`None`:`${routes.length} ${(0,format_1.pluralize)(routes.length,"route")}`}},3330:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.shouldAddMore=void 0;const inquirer_1=__importDefault(__webpack_require__(3290));exports.shouldAddMore=async function(message){const{addMore}=await inquirer_1.default.prompt([{type:"confirm",name:"addMore",message,default:!1}]);return addMore}},9468:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.resolveFactor=exports.formatAmount=void 0;const format_1=__webpack_require__(8861);let symbolsCache={};async function resolveFactor(ledger,symbolHandle){if(!symbolsCache[symbolHandle]){const{symbols}=await ledger.symbol.list();symbolsCache=symbols.reduce(((result,s)=>(result[s.handle]=s,result)),{})}return symbolsCache[symbolHandle]?.factor??1}exports.formatAmount=async function(ledger,amount,symbolHandle){const factor=await resolveFactor(ledger,symbolHandle);return(0,format_1.formatLedgerAmount)(amount,factor)},exports.resolveFactor=resolveFactor},1082:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.printSubSectionSeparator=exports.formatSectionSeparator=exports.formatStringValue=exports.formatHandleValue=exports.printStringField=exports.printAxiosResponse=exports.printAxiosRequest=exports.printAxiosRequestAndResponse=void 0;const axios_1=__importDefault(__webpack_require__(2167)),chalk_1=__importDefault(__webpack_require__(5022)),lodash_1=__webpack_require__(6517);function printAxiosRequest(requestConfig){console.log(),console.log(chalk_1.default.bold.green("Request details:"));const fullUrl=axios_1.default.getUri(requestConfig);if(console.log(chalk_1.default.green(`${requestConfig?.method?.toUpperCase()} ${fullUrl}`)),requestConfig?.data){const parsedData=JSON.parse(requestConfig?.data);console.log(chalk_1.default.gray(JSON.stringify(parsedData,null,2)))}}function printAxiosResponse(response){if(console.log(),console.log(chalk_1.default.bold.green("Response details:")),console.log(chalk_1.default.green(`Status: ${response.status} ${response.statusText}`)),response.data){const data=response.status>=400&&!process.env.TRACE?(0,lodash_1.omit)(response.data,"data.detail"):response.data;console.log(chalk_1.default.gray(JSON.stringify(data,null,2)))}else console.log(chalk_1.default.gray`<Empty body>`)}exports.printAxiosRequestAndResponse=function(response){printAxiosRequest(response.config),printAxiosResponse(response)},exports.printAxiosRequest=printAxiosRequest,exports.printAxiosResponse=printAxiosResponse,exports.printStringField=function(title,value){value&&console.log(`${chalk_1.default.bold(title)}: ${chalk_1.default.cyan(value)}`)},exports.formatHandleValue=function(value){return value?chalk_1.default.bold.cyan(value):chalk_1.default.italic.gray`None`},exports.formatStringValue=function(value){return value||chalk_1.default.italic.gray`None`},exports.formatSectionSeparator=function(padding=0){let separatorChars="";for(let i=0;i<process.stdout.columns-2*padding;i++)separatorChars+="—";return separatorChars},exports.printSubSectionSeparator=function(){console.log("........................................................................")}},692:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.formatClaimAction=exports.formatIntentStatus=exports.printIntentList=exports.printIntent=void 0;const types_1=__webpack_require__(8071),chalk_1=__importDefault(__webpack_require__(5022)),string_width_1=__importDefault(__webpack_require__(700)),table_1=__webpack_require__(1354),form_json_1=__webpack_require__(6841),formatting_1=__webpack_require__(1082),formatting_amount_1=__webpack_require__(9468);function formatIntentStatus(status){switch(status){case types_1.IntentStatus.Aborted:return chalk_1.default.red(status);case types_1.IntentStatus.Committed:return chalk_1.default.green(status);case types_1.IntentStatus.Pending:return chalk_1.default.bold.yellow(status);case types_1.IntentStatus.Completed:return chalk_1.default.bold.green(status);case types_1.IntentStatus.Rejected:return chalk_1.default.bold.red(status);default:return"unknown"}}exports.printIntent=async function(ledger,intent,meta){console.log(),console.log(chalk_1.default.green.bold("Intent summary:")),console.log(chalk_1.default.green`------------------------------------------------------------------------`),(0,formatting_1.printStringField)("Handle",intent.handle),(0,formatting_1.printStringField)("Parent",intent.parent),(0,formatting_1.printStringField)("Origin",intent.origin),console.log();for(const claim of intent.claims)console.log(`${chalk_1.default.bold("Action:")} ${chalk_1.default.cyan(claim.action)}`),claim.action!==types_1.ClaimAction.Transfer&&claim.action!==types_1.ClaimAction.Destroy||console.log(` - Source: ${chalk_1.default.cyan(claim.source)}`),claim.action!==types_1.ClaimAction.Transfer&&claim.action!==types_1.ClaimAction.Issue||console.log(` - Target: ${chalk_1.default.cyan(claim.target)}`),console.log(` - Symbol: ${chalk_1.default.cyan(claim.symbol)}`),console.log(` - Amount: ${chalk_1.default.cyan(await(0,formatting_amount_1.formatAmount)(ledger,claim.amount,claim.symbol))}`),console.log();(0,form_json_1.printSimpleMap)("Custom",intent.custom),meta&&(intent.custom&&console.log(),console.log(`${chalk_1.default.bold`Status:`} ${formatIntentStatus(meta.status)}`))},exports.printIntentList=async function(ledger,intents){const tableRows=[],spanningCells=[],horizontalLineIndexes=[];tableRows.push([chalk_1.default.bold`Handle`,chalk_1.default.bold`Source`,chalk_1.default.bold`Target`,chalk_1.default.bold`Amount`,"",chalk_1.default.bold`Status`]),spanningCells.push({col:0,row:0,colSpan:1,alignment:"left",verticalAlignment:"middle"},{col:1,row:0,colSpan:1,alignment:"right",verticalAlignment:"middle"},{col:2,row:0,colSpan:1,alignment:"right",verticalAlignment:"middle"},{col:3,row:0,colSpan:2,alignment:"center",verticalAlignment:"middle"});for(let i=0;i<intents.length;i++){const intent=intents[i],{handle,claims}=intent.data;claims.length>1&&(spanningCells.push({col:5,row:tableRows.length,rowSpan:claims.length+1}),tableRows.push([(0,formatting_1.formatHandleValue)(handle),"","","","",formatIntentStatus(intent.meta.status)])),horizontalLineIndexes.push(tableRows.length+claims.length);for(let c=0;c<claims.length;c++){const claim=claims[c];tableRows.push([1===claims.length?(0,formatting_1.formatHandleValue)(handle):"",claim.action===types_1.ClaimAction.Transfer||claim.action===types_1.ClaimAction.Destroy?claim.source:chalk_1.default.green`<issue>`,claim.action===types_1.ClaimAction.Transfer||claim.action===types_1.ClaimAction.Issue?claim.target:chalk_1.default.red`<destroy>`,chalk_1.default.magentaBright(await(0,formatting_amount_1.formatAmount)(ledger,claim.amount,claim.symbol)),claim.symbol,1===claims.length?formatIntentStatus(intent.meta.status):""])}}const widths=function(tableRows){const numberOfRows=tableRows[0].length,result=Array(numberOfRows).fill(0,0,numberOfRows);return tableRows?.reduce(((result,row)=>{for(let i=0;i<row.length;i++)result[i]=Math.max(result[i],(0,string_width_1.default)(row[i]));return result}),result)}(tableRows);console.log((0,table_1.table)(tableRows,{columns:[{alignment:"left",verticalAlignment:"top",width:widths[0]},{alignment:"right",width:widths[1]},{alignment:"right",width:widths[2]},{alignment:"right",width:widths[3]},{alignment:"center",width:widths[4]},{alignment:"center",width:widths[5]}],columnDefault:{verticalAlignment:"middle",paddingLeft:2,paddingRight:2},spanningCells,drawVerticalLine:(index,size)=>index<1||index>size-1,drawHorizontalLine:(index,size)=>index<2||index===size||horizontalLineIndexes.includes(index)}))},exports.formatIntentStatus=formatIntentStatus,exports.formatClaimAction=function(action){switch(action){case types_1.ClaimAction.Transfer:return chalk_1.default.cyan("->");case types_1.ClaimAction.Issue:return chalk_1.default.green("+");case types_1.ClaimAction.Destroy:return chalk_1.default.red("-")}}},5777:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.printLedgerInstance=exports.assertServerConnection=exports.saveServerConfig=exports.loadServerConfig=void 0;const ledger_sdk_1=__webpack_require__(1276),chalk_1=__importDefault(__webpack_require__(5022)),fs_extra_1=__importDefault(__webpack_require__(4470)),config_1=__webpack_require__(2885),authentication_1=__webpack_require__(8727),form_access_rule_1=__webpack_require__(7691),form_json_1=__webpack_require__(6841),formatting_1=__webpack_require__(1082);async function loadServerConfig(){await fs_extra_1.default.ensureFile(config_1.SERVER_CONFIG_FILE);try{return await fs_extra_1.default.readJSON(config_1.SERVER_CONFIG_FILE)}catch(error){return{}}}exports.loadServerConfig=loadServerConfig,exports.saveServerConfig=async function(config){await fs_extra_1.default.ensureFile(config_1.SERVER_CONFIG_FILE),await fs_extra_1.default.writeJSON(config_1.SERVER_CONFIG_FILE,config,{spaces:2})},exports.assertServerConnection=async function(){const serverConfig=await loadServerConfig();if(!serverConfig||!serverConfig.url)throw new Error(`Not connected to a server, please connect to a server instance by running:\n${chalk_1.default.cyan(" > minka server connect")}`);const user=await(0,authentication_1.getUserLoggedIn)();return{ledger:new ledger_sdk_1.LedgerSdk({url:serverConfig.url,defaultAuthParams:user?{aud:serverConfig.ledger,iss:"cli",keyPair:{public:user.public,schema:user.schema,secret:user.secret},sub:user.public,exp:3600}:void 0}),config:serverConfig}},exports.printLedgerInstance=function(title,ledgerInstance){const{handle,access,custom}=ledgerInstance;console.log(chalk_1.default.green.bold(title)),console.log(chalk_1.default.green`------------------------------------------------------------------------`),(0,formatting_1.printStringField)("Handle",handle),console.log(),(0,form_access_rule_1.printAccessRules)("Access rules",access),custom&&(console.log(),(0,form_json_1.printSimpleMap)("Custom",custom))}},5594:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.LocalBridgeQueue=void 0;const chalk_1=__importDefault(__webpack_require__(5022)),error_handling_1=__webpack_require__(6418);exports.LocalBridgeQueue=class LocalBridgeQueue{constructor(){this.pendingRequests=[]}async enqueue(handler){this.pendingRequests.push(handler),1===this.pendingRequests.length&&this.callNextHandler()}async callNextHandler(){const pendingCount=this.pendingRequests.length;pendingCount>1&&(console.log(),console.log(chalk_1.default.gray(`Multiple requests received (${pendingCount} remaining)`)));const nextHandler=this.pendingRequests[0];if(nextHandler){try{await nextHandler()}catch(error){(0,error_handling_1.printError)(error)}this.pendingRequests.shift(),this.callNextHandler()}}}},1189:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.registerBridge=void 0;const ledger_sdk_1=__webpack_require__(1276);exports.registerBridge=async function(ledger,bridge,keyPair){const bridgeReply=await async function(ledger,handle){try{return await ledger.bridge.read(handle)}catch(error){if(error instanceof ledger_sdk_1.LedgerSdkError&&"record-not-found"===error.status)return null;throw error}}(ledger,bridge.handle);if(!bridgeReply){const{bridge:createdBridge}=await ledger.bridge.init().data(bridge).hash().sign([{keyPair}]).send();return console.log("Bridge record not found, creating it..."),createdBridge}const{bridge:remoteBridge,response}=bridgeReply;if(remoteBridge.config.server===bridge.config.server&&remoteBridge.config.signer.public===bridge.config.signer.public)return console.log("Bridge record exists and is already up to date."),remoteBridge;const{bridge:updatedBridge}=await ledger.bridge.from(response.data).data(bridge).hash().sign([{keyPair}]).send();return console.log("Bridge record found, updating it..."),updatedBridge}},9398:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.startBridgeServer=void 0;const chalk_1=__importDefault(__webpack_require__(5022)),express_1=__importDefault(__webpack_require__(6860)),local_bridge_queue_1=__webpack_require__(5594),local_bridge_ui_1=__webpack_require__(7223);exports.startBridgeServer=function(port,ledger,keyPair){const bridgeUi=new local_bridge_ui_1.LocalBridgeUi(ledger,keyPair),bridgeQueue=new local_bridge_queue_1.LocalBridgeQueue,app=(0,express_1.default)();app.use(express_1.default.json()),app.post("/debits",(async(req,res)=>{res.status(202).json(),bridgeQueue.enqueue((()=>bridgeUi.prepareDebit(req)))})),app.post("/debits/:handle/commit",(async(req,res)=>{res.status(202).json(),bridgeQueue.enqueue((()=>bridgeUi.commitDebit(req)))})),app.post("/debits/:handle/abort",(async(req,res)=>{res.status(202).json(),bridgeQueue.enqueue((()=>bridgeUi.abortDebit(req)))})),app.post("/credits",(async(req,res)=>{res.status(202).json(),bridgeQueue.enqueue((()=>bridgeUi.prepareCredit(req)))})),app.post("/credits/:handle/commit",(async(req,res)=>{res.status(202).json(),bridgeQueue.enqueue((()=>bridgeUi.commitCredit(req)))})),app.post("/credits/:handle/abort",(async(req,res)=>{res.status(202).json(),bridgeQueue.enqueue((()=>bridgeUi.abortCredit(req)))})),app.listen(port,(()=>{console.log(),console.log(chalk_1.default.bold(`✅ Bridge is running on port ${port}.`)),console.log(chalk_1.default.gray`Press ${chalk_1.default.cyan("ctrl + c")} to exit.`),console.log(),console.log("Checking for undelivered events..."),console.log(`None found ${chalk_1.default.bold.green("✔")}`),console.log(),console.log(chalk_1.default.bold("Waiting for new events..."))}))}},7223:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.LocalBridgeUi=void 0;const format_1=__webpack_require__(8861),chalk_1=__importDefault(__webpack_require__(5022)),inquirer_1=__importDefault(__webpack_require__(3290)),formatting_1=__webpack_require__(1082),formatting_amount_1=__webpack_require__(9468);exports.LocalBridgeUi=class LocalBridgeUi{constructor(ledger,keyPair){this.symbols={},this.ledger=ledger,this.keyPair=keyPair}async prepareDebit(req){await this.printRequest("prepare","debit",req);const{reply,coreId}=await this.promptPreparationReply(),debitData=req.body.data;"p"===reply?(await this.sendSignature(debitData.intent,{handle:debitData.handle,action:debitData.action,status:"prepared",coreId}),console.log(`> Debit ${chalk_1.default.bold.green("prepared")}, reply sent to ledger ${chalk_1.default.bold.green("✔")}`)):"f"===reply?(await this.sendSignature(debitData.intent,{handle:debitData.handle,action:debitData.action,status:"failed",coreId}),console.log(`> Debit ${chalk_1.default.bold.red("failed")}, reply sent to ledger ${chalk_1.default.bold.green("✔")}`)):console.log(chalk_1.default.yellow("> WARNING: Debit ignored, no reply sent to ledger!"))}async commitDebit(req){await this.printRequest("commit","debit",req);const{reply,coreId}=await this.promptConfirmationReply(),debitData=req.body.data;"c"===reply?(await this.sendSignature(debitData.intent,{handle:debitData.handle,action:debitData.action,status:"committed",coreId}),console.log(`> Debit ${chalk_1.default.bold.green("committed")}, reply sent to ledger ${chalk_1.default.bold.green("✔")}`)):console.log(chalk_1.default.yellow("> WARNING: Commit ignored, no reply sent to ledger!"))}async abortDebit(req){await this.printRequest("abort","debit",req);const{reply,coreId}=await this.promptConfirmationReply(),debitData=req.body.data;"c"===reply?(await this.sendSignature(debitData.intent,{handle:debitData.handle,action:debitData.action,status:"aborted",coreId}),console.log(`> Debit ${chalk_1.default.bold.red("aborted")}, reply sent to ledger ${chalk_1.default.bold.green("✔")}`)):console.log(chalk_1.default.yellow("> WARNING: Abort ignored, no reply sent to ledger!"))}async prepareCredit(req){await this.printRequest("prepare","credit",req);const{reply,coreId}=await this.promptPreparationReply(),creditData=req.body.data;"p"===reply?(await this.sendSignature(creditData.intent,{handle:creditData.handle,action:creditData.action,status:"prepared",coreId}),console.log(`> Credit ${chalk_1.default.bold.green("prepared")}, reply sent to ledger ${chalk_1.default.bold.green("✔")}`)):"f"===reply?(await this.sendSignature(creditData.intent,{handle:creditData.handle,action:creditData.action,status:"failed",coreId}),console.log(`> Credit ${chalk_1.default.bold.red("failed")}, reply sent to ledger ${chalk_1.default.bold.green("✔")}`)):console.log(chalk_1.default.yellow("> WARNING: Credit ignored, no reply sent to ledger!"))}async commitCredit(req){await this.printRequest("commit","credit",req);const{reply,coreId}=await this.promptConfirmationReply(),creditData=req.body.data;"c"===reply?(await this.sendSignature(creditData.intent,{handle:creditData.handle,action:creditData.action,status:"committed",coreId}),console.log(`> Credit ${chalk_1.default.bold.green("committed")}, reply sent to ledger ${chalk_1.default.bold.green("✔")}`)):console.log(chalk_1.default.yellow("> WARNING: Commit ignored, no reply sent to ledger!"))}async abortCredit(req){await this.printRequest("abort","credit",req);const{reply,coreId}=await this.promptConfirmationReply(),creditData=req.body.data;"c"===reply?(await this.sendSignature(creditData.intent,{handle:creditData.handle,action:creditData.action,status:"aborted",coreId}),console.log(`> Credit ${chalk_1.default.bold.red("aborted")}, reply sent to ledger ${chalk_1.default.bold.green("✔")}`)):console.log(chalk_1.default.yellow("> WARNING: Abort ignored, no reply sent to ledger!"))}async sendSignature(intent,customData){const ledgerReply=await this.ledger.intent.from(intent).hash().sign([{keyPair:this.keyPair,custom:customData}]).send();if(process.env.VERBOSE){const{response}=ledgerReply;(0,formatting_1.printAxiosRequestAndResponse)(response)}return ledgerReply}async printRequest(operationPhase,operationType,req){const data=req.body.data,{intent,amount,symbol}=data;process.env.VERBOSE&&(console.log(),console.log(),console.log(chalk_1.default.bold.yellow("New bridge request received:")),console.log(chalk_1.default.green`${req.method} ${req.url}`),console.log(),console.log(chalk_1.default.gray(JSON.stringify(data,null,2)))),console.log(),console.log(chalk_1.default.bold(`${chalk_1.default.green(`${operationPhase}-${operationType}`)} for intent ${chalk_1.default.cyan(intent.data.handle)} received:`)),console.log("------------------------------------------"),intent.data.origin&&console.log(chalk_1.default.bold(` - Origin: ${chalk_1.default.cyan(intent.data.origin)}  ${chalk_1.default.gray("[originating intent handle]")}`)),data.source?console.log(chalk_1.default.bold(` - Source: ${chalk_1.default.cyan(data.source)}`)):data.target&&console.log(chalk_1.default.bold(` - Target: ${chalk_1.default.cyan(data.target)}`)),console.log(chalk_1.default.bold(` - Amount: ${chalk_1.default.cyan(await(0,formatting_amount_1.formatAmount)(this.ledger,amount,symbol))}`)),console.log(chalk_1.default.bold(` - Symbol: ${chalk_1.default.cyan(symbol)}`)),console.log("------------------------------------------")}async promptPreparationReply(){return inquirer_1.default.prompt([{type:"expand",name:"reply",message:`Type ${chalk_1.default.cyan("p")} to prepare, ${chalk_1.default.cyan("f")} to fail or ${chalk_1.default.cyan("i")} to ignore:`,choices:[{name:"Prepare",value:"p",key:"p"},{name:"Fail",value:"f",key:"f"},{name:"Ignore",value:"i",key:"i"}],default:0},{type:"input",name:"coreId",when:({reply})=>["p","f"].includes(reply),message:"Core Id:",filter:(input,answers)=>("p"===answers.reply&&(0,format_1.assertNotEmptyString)(input),input)}])}async promptConfirmationReply(){return inquirer_1.default.prompt([{type:"expand",name:"reply",message:`Type ${chalk_1.default.cyan("c")} to confirm or ${chalk_1.default.cyan("i")} to ignore:`,choices:[{name:"Confirm",value:"c",key:"c"},{name:"Ignore",value:"i",key:"i"}],default:0},{type:"input",name:"coreId",when:({reply})=>"c"===reply,message:"Core Id:",filter:input=>((0,format_1.assertNotEmptyString)(input),input)}])}}},2180:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.promptPagination=void 0;const chalk_1=__importDefault(__webpack_require__(5022)),inquirer_1=__importDefault(__webpack_require__(3290));exports.promptPagination=async function(page){const totalPages=Math.ceil(page.total/page.limit),messagePrefix=`Showing page ${page.index+1} of ${totalPages}. Press `,messageSuffixes=[],choices=[{name:"Quit",value:"q",key:"q"}];page.index>0&&(choices.push({name:"Previous",value:"p",key:"p"}),messageSuffixes.push(`${chalk_1.default.cyan("p")} for previous`)),page.index<totalPages-1&&(choices.push({name:"Next",value:"n",key:"n"}),messageSuffixes.push(`${chalk_1.default.cyan("n")} for next`)),messageSuffixes.push(`${chalk_1.default.cyan("q")} to quit`);const{nextAction}=await inquirer_1.default.prompt([{type:"expand",name:"nextAction",message:messagePrefix+messageSuffixes.join(", "),choices,default:0}]);return nextAction}},894:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.promptSigner=exports.promptSigners=exports.assertSigners=exports.saveDeviceSigner=exports.loadRemoteSigners=exports.loadDeviceSigners=void 0;const crypto_1=__webpack_require__(8286),format_1=__webpack_require__(8861),chalk_1=__importDefault(__webpack_require__(5022)),fs_extra_1=__importDefault(__webpack_require__(4470)),inquirer_1=__importDefault(__webpack_require__(3290)),lodash_1=__importDefault(__webpack_require__(6517)),config_1=__webpack_require__(2885),ledger_1=__webpack_require__(5777);async function loadDeviceSigners(){await fs_extra_1.default.ensureFile(config_1.SIGNERS_FILE);try{return await fs_extra_1.default.readJSON(config_1.SIGNERS_FILE)}catch(error){return{}}}async function loadRemoteSigners(){const response={},{ledger}=await(0,ledger_1.assertServerConnection)(),{signers}=await ledger.signer.list();return signers.filter((signer=>signer.secret)).forEach((signer=>{response[signer.handle]={schema:signer.schema,public:signer.public,secret:signer.secret}})),response}function prepareSignersForChoices(signerDictionary){return Object.keys(signerDictionary).map((signerHandle=>({name:signerHandle,value:{handle:signerHandle,data:signerDictionary[signerHandle]}})))}function getSignerChoices(signersList){const{device:deviceSigners,remote:remoteSigners}=signersList,deviceSignersForPrompt=prepareSignersForChoices(deviceSigners),remoteSignersForPrompt=prepareSignersForChoices(remoteSigners),choices=[];return deviceSignersForPrompt.length&&(choices.push(new inquirer_1.default.Separator("----Device----")),choices.push(...deviceSignersForPrompt)),remoteSignersForPrompt.length&&(choices.push(new inquirer_1.default.Separator("----Remote----")),choices.push(...remoteSignersForPrompt)),choices}async function promptSecretPassword(handle,secret){const{password}=await inquirer_1.default.prompt([{type:"password",name:"password",message:`Key password for ${handle}`,filter:async input=>((0,format_1.assertNotEmptyString)(input),await async function(password,encryptedSecret){try{await(0,crypto_1.decryptSecretKey)(encryptedSecret,password)}catch(err){throw new Error("Incorrect password.")}}(input,secret),input)}]);return password}exports.loadDeviceSigners=loadDeviceSigners,exports.loadRemoteSigners=loadRemoteSigners,exports.saveDeviceSigner=async function(handle,keyPair,customData){const existingSigners=await loadDeviceSigners();await fs_extra_1.default.writeJSON(config_1.SIGNERS_FILE,{...existingSigners||{},[handle]:{...keyPair,custom:customData}},{spaces:2})},exports.assertSigners=async function(){const[deviceSigners,remoteSigners]=await Promise.all([loadDeviceSigners(),loadRemoteSigners()]);if((!deviceSigners||lodash_1.default.isEmpty(deviceSigners))&&(!remoteSigners||lodash_1.default.isEmpty(remoteSigners)))throw new Error(`No signers found. This command requires at least one signer.\nPlease create a signer first by running:\n${chalk_1.default.cyan(" > minka signer create")}`);return{device:deviceSigners?{...deviceSigners}:{},remote:remoteSigners?{...remoteSigners}:{}}},exports.promptSigners=async function(signersList){const choices=getSignerChoices(signersList),{signers}=await inquirer_1.default.prompt([{type:"checkbox",name:"signers",message:"Signers:",pageSize:choices.length,validate:selection=>((0,format_1.assertOptionsSelected)(selection,1),!0),choices}]),parsedSigners=[];for(const signer of signers){const{data:{secret}}=signer;if((0,crypto_1.isSecretKeyEncrypted)(secret)){const password=await promptSecretPassword(signer.handle,secret);signer.data.secret=await(0,crypto_1.decryptSecretKey)(secret,password)}parsedSigners.push(signer)}return parsedSigners},exports.promptSigner=async function(signersList){const choices=getSignerChoices(signersList),{signer}=await inquirer_1.default.prompt([{type:"list",name:"signer",pageSize:choices.length,message:"Signer:",validate:selection=>((0,format_1.assertOptionsSelected)(selection,1),!0),choices}]),{data:{secret}}=signer;if((0,crypto_1.isSecretKeyEncrypted)(secret)){const password=await promptSecretPassword(signer.handle,secret);signer.data.secret=await(0,crypto_1.decryptSecretKey)(secret,password)}return signer}},4140:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.promptUpdateRoutes=exports.promptBridgeField=exports.bridgeInquirerQuestion=exports.handleInquirerQuestion=exports.promptUpdateWallet=exports.editWallet=exports.printWalletList=exports.printWallet=void 0;const format_1=__webpack_require__(8861),chalk_1=__importDefault(__webpack_require__(5022)),inquirer_1=__importDefault(__webpack_require__(3290)),table_1=__webpack_require__(1354),wallet_update_1=__webpack_require__(6954),access_1=__webpack_require__(6570),editor_json_1=__webpack_require__(6110),form_1=__webpack_require__(3330),form_access_rule_1=__webpack_require__(7691),form_json_1=__webpack_require__(6841),form_route_1=__webpack_require__(3228),formatting_1=__webpack_require__(1082);async function promptBridgeField(){const{bridge}=await inquirer_1.default.prompt([exports.bridgeInquirerQuestion]);return bridge}async function promptUpdateRoutes(routes){const{routeUpdateAnswer}=await inquirer_1.default.prompt([{type:"expand",name:"routeUpdateAnswer",message:`Type ${chalk_1.default.cyan("a")} to add a new route or ${chalk_1.default.cyan("e")} to edit routes using an editor`,choices:[{name:"Add route",value:"a",key:"a"},{name:"Edit",value:"e",key:"e"}],default:0}]);if("a"===routeUpdateAnswer){const newRoutes=routes?[...routes]:[];for(;;){const newRoute=await(0,form_route_1.promptRoute)();newRoutes.push(newRoute);if(!await(0,form_1.shouldAddMore)("Add another route?"))break}return newRoutes}return await(0,form_route_1.editRoutes)(routes)}exports.printWallet=function(wallet){console.log(),console.log(chalk_1.default.green.bold("Wallet summary:")),console.log(chalk_1.default.green`------------------------------------------------------------------------`),(0,formatting_1.printStringField)("Handle",wallet.handle),(0,formatting_1.printStringField)("Parent",wallet.parent),(0,formatting_1.printStringField)("Bridge",wallet.bridge),wallet.custom&&console.log(),(0,form_json_1.printSimpleMap)("Custom",wallet.custom),wallet.routes&&console.log(),(0,form_route_1.printRoutes)("Routes",wallet.routes),wallet.access&&console.log(),(0,form_access_rule_1.printAccessRules)("Access rules",wallet.access),console.log()},exports.printWalletList=function(wallets){const tableRows=[];tableRows.push([chalk_1.default.bold`Handle`,chalk_1.default.bold`Bridge`,chalk_1.default.bold`Custom`,chalk_1.default.bold`Routes`]);for(const wallet of wallets)tableRows.push([(0,formatting_1.formatHandleValue)(wallet.handle),(0,formatting_1.formatStringValue)(wallet.bridge),(0,form_json_1.formatSimpleMap)(wallet.custom),(0,form_route_1.formatRouteSummary)(wallet.routes)]);console.log((0,table_1.table)(tableRows,{columnDefault:{verticalAlignment:"middle",paddingLeft:2,paddingRight:2}}))},exports.editWallet=async function(wallet,hash){return(0,editor_json_1.promptJsonEditor)({name:"new wallet",default:wallet,schema:(0,wallet_update_1.createWalletUpdateSchema)(wallet.handle,hash)})},exports.promptUpdateWallet=async function(wallet){const newData={...wallet};for(console.log(chalk_1.default.green.bold`Updates:`),console.log("------------------------------------------");;){const{updateAnswer}=await inquirer_1.default.prompt([{type:"list",name:"updateAnswer",message:`Select the field to update, select ${chalk_1.default.cyan("Finish")} to save changes.`,choices:[{name:"Finish",value:".",key:"."},{name:"Bridge",value:"b",key:"b"},{name:"Custom",value:"c",key:"c"},{name:"Routes",value:"r",key:"r"},{name:"Access",value:"a",key:"a"}],default:0}]);if("."===updateAnswer){console.log(chalk_1.default.green`Updates received.`);break}switch(updateAnswer){case"b":newData.bridge=await promptBridgeField();break;case"c":newData.custom=await(0,form_json_1.promptSimpleMap)();break;case"r":newData.routes=await promptUpdateRoutes(newData.routes);break;case"a":newData.access=await(0,access_1.editAccess)(newData.access)}}return newData},exports.handleInquirerQuestion={type:"input",name:"handle",message:"Handle:",filter:input=>((0,format_1.assertNotEmptyString)(input),(0,format_1.assertValidIdentifier)(input,"address"),input)},exports.bridgeInquirerQuestion={type:"input",name:"bridge",message:"Bridge:",filter:input=>(input.length&&(0,format_1.assertValidIdentifier)(input,"address"),input),transformer:input=>0===input.length?chalk_1.default.italic.gray("[none]"):input},exports.promptBridgeField=promptBridgeField,exports.promptUpdateRoutes=promptUpdateRoutes},8286:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&!("get"in desc?!m.__esModule:desc.writable||desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)"default"===p||Object.prototype.hasOwnProperty.call(exports,p)||__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(__webpack_require__(7636),exports),__exportStar(__webpack_require__(6090),exports),__exportStar(__webpack_require__(9517),exports),__exportStar(__webpack_require__(6503),exports)},6819:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.importEncryptedPrivateKey=exports.exportEncryptedPrivateKey=void 0;const asn1_1=__webpack_require__(8596);exports.exportEncryptedPrivateKey=function(key){const iterationsBuffer=Buffer.alloc(2);return iterationsBuffer.writeUInt16BE(key.iterations),Buffer.concat([Buffer.from(asn1_1.ASN1_PKCS5_SALT_PREFIX,"hex"),key.salt,Buffer.from(asn1_1.ASN1_PKCS5_ITERATIONS_PREFIX,"hex"),iterationsBuffer,Buffer.from(asn1_1.ASN1_PKCS5_IV_PREFIX,"hex"),key.iv,Buffer.from(asn1_1.ASN1_PKCS5_VALUE_PREFIX,"hex"),key.value]).toString("base64")},exports.importEncryptedPrivateKey=function(key){const payloadAsn1Hex=Buffer.from(key,"base64").toString("hex"),{salt,iterations,iv,value}=(0,asn1_1.parsePkcs5EncryptedKey)(payloadAsn1Hex);return{salt:Buffer.from(salt,"hex"),iterations:Buffer.from(iterations,"hex").readUInt16BE(),iv:Buffer.from(iv,"hex"),value:Buffer.from(value,"hex")}}},7443:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&!("get"in desc?!m.__esModule:desc.writable||desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.verifyJWT=exports.signJWT=exports.parseB64Object=exports.bufferConcat=void 0;const jose_1=__webpack_require__(1567),ed25519=__importStar(__webpack_require__(599)),util_1=__webpack_require__(3837);function bufferConcat(...buffers){const size=buffers.reduce(((acc,{length})=>acc+length),0),buf=new Uint8Array(size);let i=0;return buffers.forEach((buffer=>{buf.set(buffer,i),i+=buffer.length})),buf}function parseB64Object(b64){const decoder=new util_1.TextDecoder,decoded=jose_1.base64url.decode(b64);return JSON.parse(decoder.decode(decoded))}exports.bufferConcat=bufferConcat,exports.parseB64Object=parseB64Object,exports.signJWT=async function(payload,secret){const encoder=new util_1.TextEncoder;let payloadBuffer=encoder.encode(JSON.stringify(payload));payloadBuffer=encoder.encode(jose_1.base64url.encode(payloadBuffer));const header={alg:"EdDSA"},data=bufferConcat(encoder.encode(jose_1.base64url.encode(JSON.stringify(header))),encoder.encode("."),payloadBuffer),dataHash=Buffer.from(data).toString("hex"),privateKey=Buffer.from(secret,"base64");try{const signature=await ed25519.sign(dataHash,privateKey),encodedSignature=jose_1.base64url.encode(signature);return`${jose_1.base64url.encode(JSON.stringify(header))}.${jose_1.base64url.encode(JSON.stringify(payload))}.${encodedSignature}`}catch(error){if("Expected 32 bytes"===error.message){const publicLength=Buffer.from(secret,"base64").toString("hex").length;throw new Error(`Unexpected raw private key length in hex ${publicLength}, expected 64`)}throw new Error("jwt signing failed")}},exports.verifyJWT=async function(jws,publicKey){const encoder=new util_1.TextEncoder,{0:protectedHeader,1:payload,2:signature}=jws.split(".");if(!protectedHeader||!payload||!signature)throw new Error("Invalid Compact JWS");const data=bufferConcat(encoder.encode(protectedHeader),encoder.encode("."),encoder.encode(payload)),dataHash=Buffer.from(data).toString("hex");let verified=!1;try{verified=await ed25519.verify(Buffer.from(signature,"base64"),dataHash,Buffer.from(publicKey,"base64"))}catch(error){if("Expected 32 bytes"===error.message){const publicLength=Buffer.from(publicKey,"base64").toString("hex").length;throw new Error(`Unexpected raw public key length in hex ${publicLength}, expected 64`)}verified=!1}if(!verified)throw new Error("signature verification failed");const decodedPayload=parseB64Object(payload);if(decodedPayload.iat>=decodedPayload.exp||decodedPayload.exp<Date.now()/1e3)throw new Error('"exp" claim timestamp check failed');return{payload:parseB64Object(payload),protectedHeader:parseB64Object(protectedHeader)}}},3144:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&!("get"in desc?!m.__esModule:desc.writable||desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.decryptSecretKey=exports.encryptSecretKey=exports.createKeyPair=void 0;const ed25519=__importStar(__webpack_require__(599)),crypto_1=__importDefault(__webpack_require__(6113)),asn1_1=__webpack_require__(8596),format_1=__webpack_require__(6819),webcrypto=global?.crypto??crypto_1.default?.webcrypto;function assertWebcryptoSupport(){if(!webcrypto)throw new Error("Unable to perform operation, `webcrypto` is not defined");if(!webcrypto.subtle)throw new Error("Unable to perform operation, `webcrypto.subtle` is not defined")}exports.createKeyPair=async function(){const privateKey=ed25519.utils.randomPrivateKey(),publicKey=await ed25519.getPublicKey(privateKey);return{schema:"ed25519",public:Buffer.from(publicKey).toString("base64"),secret:Buffer.from(privateKey).toString("base64")}},exports.encryptSecretKey=async function(secret,password){assertWebcryptoSupport();const salt=webcrypto.getRandomValues(new Uint8Array(8)),iv=webcrypto.getRandomValues(new Uint8Array(16)),keyMaterial=await webcrypto.subtle.importKey("raw",Buffer.from(password,"utf-8"),"PBKDF2",!1,["deriveKey"]),key=await webcrypto.subtle.deriveKey({name:"PBKDF2",salt,iterations:2048,hash:"SHA-256"},keyMaterial,{name:"AES-CBC",length:256},!1,["encrypt"]),secretHex=Buffer.from(secret,"base64").toString("hex"),encrypted=await webcrypto.subtle.encrypt({name:"AES-CBC",iv},key,Buffer.from((0,asn1_1.privateKeyRawToDer)(secretHex),"hex")),encryptedKey={salt,iterations:2048,iv,value:Buffer.from(encrypted)};return(0,format_1.exportEncryptedPrivateKey)(encryptedKey)},exports.decryptSecretKey=async function(secret,password){assertWebcryptoSupport();const{salt,iterations,iv,value}=(0,format_1.importEncryptedPrivateKey)(secret),keyMaterial=await webcrypto.subtle.importKey("raw",Buffer.from(password,"utf-8"),"PBKDF2",!1,["deriveKey"]),key=await webcrypto.subtle.deriveKey({name:"PBKDF2",salt,iterations,hash:"SHA-256"},keyMaterial,{name:"AES-CBC",length:256},!1,["decrypt"]);let decrypted;try{decrypted=await webcrypto.subtle.decrypt({name:"AES-CBC",iv},key,value)}catch(error){throw new Error("Unable to decrypt secret key")}const rawKeyHex=(0,asn1_1.privateKeyDerToRaw)(Buffer.from(decrypted).toString("hex"));return Buffer.from(rawKeyHex,"hex").toString("base64")}},1477:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&!("get"in desc?!m.__esModule:desc.writable||desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result};Object.defineProperty(exports,"__esModule",{value:!0}),exports.verifySignature=exports.signHash=void 0;const ed25519=__importStar(__webpack_require__(599)),asserts_1=__webpack_require__(7115);exports.signHash=async function(hash,keyPair){(0,asserts_1.assertSigningSchema)(keyPair.schema);const privateKey=Buffer.from(keyPair.secret,"base64"),signature=await ed25519.sign(hash,privateKey);return{schema:keyPair.schema,public:keyPair.public,digest:hash,result:Buffer.from(signature).toString("base64")}},exports.verifySignature=async function(hash,signature){return(0,asserts_1.assertSigningSchema)(signature.schema),ed25519.verify(Buffer.from(signature.result,"base64"),hash,Buffer.from(signature.public,"base64"))}},8596:(__unused_webpack_module,exports)=>{function isValidPkcs5EncryptedKey(pkcs5PayloadHex){return exports.ASN1_PKCS5_REGEX.test(pkcs5PayloadHex)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.publicKeyRawToDer=exports.publicKeyDerToRaw=exports.privateKeyRawToDer=exports.privateKeyDerToRaw=exports.isValidPkcs5EncryptedKey=exports.assertPkcs5EncryptedKey=exports.parsePkcs5EncryptedKey=exports.ASN1_PKCS5_REGEX=exports.ASN1_PKCS5_VALUE_PREFIX=exports.ASN1_PKCS5_IV_PREFIX=exports.ASN1_PKCS5_ITERATIONS_PREFIX=exports.ASN1_PKCS5_SALT_PREFIX=exports.ASN1_PUBLIC_PREFIX=exports.ASN1_PRIVATE_PREFIX=void 0,exports.ASN1_PRIVATE_PREFIX="302e020100300506032b657004220420",exports.ASN1_PUBLIC_PREFIX="302a300506032b6570032100",exports.ASN1_PKCS5_SALT_PREFIX="30819b305706092a864886f70d01050d304a302906092a864886f70d01050c301c0408",exports.ASN1_PKCS5_ITERATIONS_PREFIX="0202",exports.ASN1_PKCS5_IV_PREFIX="300c06082a864886f70d02090500301d060960864801650304012a0410",exports.ASN1_PKCS5_VALUE_PREFIX="0440",exports.ASN1_PKCS5_REGEX=new RegExp(`^${exports.ASN1_PKCS5_SALT_PREFIX}(?<salt>[0-9a-f]{16})${exports.ASN1_PKCS5_ITERATIONS_PREFIX}((?<iterations>[0-9a-f]{4}))${exports.ASN1_PKCS5_IV_PREFIX}(?<iv>[0-9a-f]{32})${exports.ASN1_PKCS5_VALUE_PREFIX}(?<value>[0-9a-f]{128})$`),exports.parsePkcs5EncryptedKey=function(pkcs5PayloadHex){const match=exports.ASN1_PKCS5_REGEX.exec(pkcs5PayloadHex);if(!match)throw new Error("Invalid pkcs5 encrypted key format");return match.groups},exports.assertPkcs5EncryptedKey=function(pkcs5PayloadHex){if(!isValidPkcs5EncryptedKey(pkcs5PayloadHex))throw new Error("Invalid pkcs5 encrypted key format")},exports.isValidPkcs5EncryptedKey=isValidPkcs5EncryptedKey,exports.privateKeyDerToRaw=function(keyHex){if(96!=keyHex.length)throw new Error(`Unexpected der private key length in hex ${keyHex.length}, expected 96`);if(!keyHex.startsWith(exports.ASN1_PRIVATE_PREFIX))throw new Error("Unexpected private key prefix");return keyHex.slice(exports.ASN1_PRIVATE_PREFIX.length)},exports.privateKeyRawToDer=function(keyHex){if(64!=keyHex.length)throw new Error(`Unexpected raw private key length in hex ${keyHex.length}, expected 64`);return`${exports.ASN1_PRIVATE_PREFIX}${keyHex}`},exports.publicKeyDerToRaw=function(keyHex){if(88!=keyHex.length)throw new Error(`Unexpected der public key length in hex ${keyHex.length}, expected 88`);if(!keyHex.startsWith(exports.ASN1_PUBLIC_PREFIX))throw new Error("Unexpected public key prefix");return keyHex.slice(exports.ASN1_PUBLIC_PREFIX.length)},exports.publicKeyRawToDer=function(keyHex){if(64!=keyHex.length)throw new Error(`Unexpected raw public key length in hex ${keyHex.length}, expected 64`);return`${exports.ASN1_PUBLIC_PREFIX}${keyHex}`}},7115:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.assertSigningSchema=void 0,exports.assertSigningSchema=function(schema){if("ed25519"!==schema)throw new Error(`Unsupported schema, expected 'ed25519', but got: '${schema}'`)}},7636:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.createCompositeHash=exports.createHash=void 0;const crypto_1=__importDefault(__webpack_require__(6113)),serialization_1=__webpack_require__(881);function createHash(data){const serializedData=(0,serialization_1.serializeData)(data),dataHash=crypto_1.default.createHash("sha256").update(serializedData).digest("hex");return crypto_1.default.createHash("sha256").update(dataHash+serializedData).digest("hex")}exports.createHash=createHash,exports.createCompositeHash=function(dataHash,signatureCustom){if(!signatureCustom)return dataHash;const signatureHash=createHash(signatureCustom);return createHash(`${dataHash}.${signatureHash}`)}},6503:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.verifyJWT=exports.signJWT=exports.decodeJWT=void 0;const detect_node_1=__importDefault(__webpack_require__(7805)),lodash_1=__importDefault(__webpack_require__(6517)),jose_1=__webpack_require__(1567),jwt_1=__webpack_require__(6096),jwt_2=__webpack_require__(7443),format_1=__webpack_require__(8861);exports.decodeJWT=function(jwt){return function(payload){const{iss,sub,aud,jti,exp,iat,hsh}=payload,errors=[];if(iss&&lodash_1.default.isString(iss)||errors.push('"iss" must be a string'),aud&&lodash_1.default.isString(aud)||errors.push('"aud" must be a string'),jti&&!lodash_1.default.isString(jti)&&errors.push('"jti" must be a string'),hsh&&!lodash_1.default.isString(hsh)&&errors.push('"hsh" must be a string'),(!lodash_1.default.isNumber(iat)||iat<=0)&&errors.push('"iat" must be a positive number'),(!lodash_1.default.isNumber(exp)||exp<=0)&&errors.push('"exp" must be a positive number'),exp<iat&&errors.push('"exp" must be greater than "iat"'),errors.length)throw Error(`JWT Payload validation ${(0,format_1.pluralize)(errors.length,"error")}: ${errors.join(",")}.`);return{iss,sub,aud,jti,exp,iat,hsh}}((0,jose_1.decodeJwt)(jwt))},exports.signJWT=async function(payload,secret){return detect_node_1.default?(0,jwt_1.signJWT)(payload,secret):(0,jwt_2.signJWT)(payload,secret)},exports.verifyJWT=function(jwt,publicKey){return detect_node_1.default?(0,jwt_1.verifyJWT)(jwt,publicKey):(0,jwt_2.verifyJWT)(jwt,publicKey)}},6090:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SUPPORTED_KEY_SCHEMAS=exports.isSecretKeyEncrypted=exports.decryptSecretKey=exports.encryptSecretKey=exports.createKeyPair=void 0;const detect_node_1=__importDefault(__webpack_require__(7805)),keys_1=__webpack_require__(3144),asn1_1=__webpack_require__(8596),keys_2=__webpack_require__(4419);exports.createKeyPair=async function(){return detect_node_1.default?(0,keys_2.createKeyPair)():(0,keys_1.createKeyPair)()},exports.encryptSecretKey=async function(secret,password){return detect_node_1.default?(0,keys_2.encryptSecretKey)(secret,password):(0,keys_1.encryptSecretKey)(secret,password)},exports.decryptSecretKey=async function(secret,password){return detect_node_1.default?(0,keys_2.decryptSecretKey)(secret,password):(0,keys_1.decryptSecretKey)(secret,password)},exports.isSecretKeyEncrypted=function(secret){return(0,asn1_1.isValidPkcs5EncryptedKey)(Buffer.from(secret,"base64").toString("hex"))},exports.SUPPORTED_KEY_SCHEMAS=["ed25519"]},3099:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.importPrivateKey=exports.importPublicKey=exports.exportPrivateKey=exports.exportPublicKey=void 0;const crypto_1=__webpack_require__(6113),asn1_1=__webpack_require__(8596);exports.exportPublicKey=function(key){if("public"!==key.type)throw new Error(`Unexpected key type '${key.type}', expected 'public'`);const keyAsn1Hex=key.export({format:"der",type:"spki"}).toString("hex");return Buffer.from((0,asn1_1.publicKeyDerToRaw)(keyAsn1Hex),"hex").toString("base64")},exports.exportPrivateKey=function(key){if("private"!==key.type)throw new Error(`Unexpected key type '${key.type}', expected 'private'`);const keyAsn1Hex=key.export({format:"der",type:"pkcs8"}).toString("hex");return Buffer.from((0,asn1_1.privateKeyDerToRaw)(keyAsn1Hex),"hex").toString("base64")},exports.importPublicKey=function(key){const keyHex=Buffer.from(key,"base64").toString("hex");return(0,crypto_1.createPublicKey)({format:"der",type:"spki",key:Buffer.from((0,asn1_1.publicKeyRawToDer)(keyHex),"hex")})},exports.importPrivateKey=function(key){const keyHex=Buffer.from(key,"base64").toString("hex");return(0,crypto_1.createPrivateKey)({format:"der",type:"pkcs8",key:Buffer.from((0,asn1_1.privateKeyRawToDer)(keyHex),"hex")})}},6096:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.verifyJWT=exports.signJWT=void 0;const jose_1=__webpack_require__(1567),format_1=__webpack_require__(3099);exports.signJWT=async function(payload,secret){return await new jose_1.SignJWT(payload).setProtectedHeader({alg:"EdDSA"}).sign((0,format_1.importPrivateKey)(secret))},exports.verifyJWT=async function(jwt,publicKey){return(0,jose_1.jwtVerify)(jwt,(0,format_1.importPublicKey)(publicKey),{algorithms:["EdDSA"]})}},4419:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.decryptSecretKey=exports.encryptSecretKey=exports.createKeyPair=void 0;const crypto_1=__webpack_require__(6113),util_1=__webpack_require__(3837),asn1_1=__webpack_require__(8596),format_1=__webpack_require__(3099),generateKeyPairAsync=crypto_1.generateKeyPair&&(0,util_1.promisify)(crypto_1.generateKeyPair);function assertCryptoSupport(){if(!generateKeyPairAsync)throw new Error("Unable to perform operation, `crypto.generateKeyPair` is not defined");if(!crypto_1.createPrivateKey)throw new Error("Unable to perform operation, `crypto.createPrivateKey` is not defined")}exports.createKeyPair=async function(){assertCryptoSupport();const keyPair=await generateKeyPairAsync("ed25519");return{schema:"ed25519",public:(0,format_1.exportPublicKey)(keyPair.publicKey),secret:(0,format_1.exportPrivateKey)(keyPair.privateKey)}},exports.encryptSecretKey=async function(secret,password){return assertCryptoSupport(),(0,format_1.importPrivateKey)(secret).export({format:"der",type:"pkcs8",passphrase:password,cipher:"aes-256-cbc"}).toString("base64")},exports.decryptSecretKey=async function(secret,password){assertCryptoSupport(),(0,asn1_1.assertPkcs5EncryptedKey)(Buffer.from(secret,"base64").toString("hex"));try{const key=(0,crypto_1.createPrivateKey)({key:Buffer.from(secret,"base64"),format:"der",type:"pkcs8",passphrase:password});return(0,format_1.exportPrivateKey)(key)}catch(error){if("ERR_OSSL_EVP_BAD_DECRYPT"===error?.code)throw new Error("Unable to decrypt secret key");throw error}}},2092:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.verifySignature=exports.signHash=void 0;const crypto_1=__importDefault(__webpack_require__(6113)),asserts_1=__webpack_require__(7115),format_1=__webpack_require__(3099);exports.signHash=async function(hash,keyPair){if((0,asserts_1.assertSigningSchema)(keyPair.schema),!crypto_1.default.sign)throw new Error("Unable to sign hash, `crypto.sign` is not defined");const hashBuffer=Buffer.from(hash,"hex"),key=(0,format_1.importPrivateKey)(keyPair.secret),result=crypto_1.default.sign(void 0,hashBuffer,key).toString("base64");return{schema:keyPair.schema,public:keyPair.public,digest:hash,result}},exports.verifySignature=async function(hash,signature){if((0,asserts_1.assertSigningSchema)(signature.schema),!crypto_1.default.verify)throw new Error("Unable to verify signature, `crypto.verify` is not defined");const hashBuffer=Buffer.from(hash,"hex"),signatureBuffer=Buffer.from(signature.result,"base64"),key=(0,format_1.importPublicKey)(signature.public);return crypto_1.default.verify(void 0,hashBuffer,key,signatureBuffer)}},881:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.serializeData=void 0;const safe_stable_stringify_1=__importDefault(__webpack_require__(8730));exports.serializeData=function(data){return(0,safe_stable_stringify_1.default)(data)}},9517:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.verifySignature=exports.signHash=void 0;const detect_node_1=__importDefault(__webpack_require__(7805)),signing_1=__webpack_require__(1477),hashing_1=__webpack_require__(7636),signing_2=__webpack_require__(2092);exports.signHash=async function(hash,keyPair,customData){const compositeHash=(0,hashing_1.createCompositeHash)(hash,customData);return detect_node_1.default?(0,signing_2.signHash)(compositeHash,keyPair):(0,signing_1.signHash)(compositeHash,keyPair)},exports.verifySignature=async function(hash,signature){const compositeHash=(0,hashing_1.createCompositeHash)(hash,signature.custom);return signature.digest===compositeHash&&(detect_node_1.default?(0,signing_2.verifySignature)(compositeHash,signature):(0,signing_1.verifySignature)(compositeHash,signature))}},8861:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&!("get"in desc?!m.__esModule:desc.writable||desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)"default"===p||Object.prototype.hasOwnProperty.call(exports,p)||__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(__webpack_require__(3194),exports),__exportStar(__webpack_require__(6917),exports)},3194:(__unused_webpack_module,exports)=>{function fromLedgerAmount(ledgerAmount,factor){if(ledgerAmount%1!=0)throw new Error("Input amount is not an integer");return ledgerAmount/factor}Object.defineProperty(exports,"__esModule",{value:!0}),exports.pluralize=exports.formatList=exports.toLedgerAmount=exports.fromLedgerAmount=exports.formatLedgerAmount=void 0,exports.formatLedgerAmount=function(ledgerAmount,factor){const nominalAmount=fromLedgerAmount(ledgerAmount,factor),numberOfDigits=Math.log10(factor);return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:numberOfDigits,minimumFractionDigits:numberOfDigits}).format(nominalAmount)},exports.fromLedgerAmount=fromLedgerAmount,exports.toLedgerAmount=function(nominalAmount,factor){const ledgerAmount=nominalAmount*factor;if(ledgerAmount%1!=0)throw new Error("Input nominal amount with given factor should produce integer ledger amount");return ledgerAmount};const listFormatter=new Intl.ListFormat("en-US",{style:"long",type:"conjunction"});exports.formatList=function(items){return listFormatter.format(items)},exports.pluralize=function(count,noun,suffix="s"){return 1===count?noun:`${noun}${suffix}`}},6917:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.assertContains=exports.assertValidUrl=exports.assertOptionsSelected=exports.assertValidWithFactor=exports.assertPowerOf10=exports.assertLessThanOrEqual=exports.assertGreaterThanOrEqual=exports.assertGreaterThan=exports.assertNumber=exports.assertValidIdentifier=exports.ADDRESS_REGEX=exports.HANDLE_REGEX=exports.assertNotEmptyString=void 0,exports.assertNotEmptyString=function(value){if("string"!=typeof value||""===value)throw new Error("Value cannot be empty.")},exports.HANDLE_REGEX=/^[a-z][a-z0-9_\-.]*$/,exports.ADDRESS_REGEX=/^(((?<schema>[a-zA-Z0-9_\-+.]+):)?(?<handle>[a-zA-Z0-9_\-+.]+))(@(?<parent>[a-zA-Z0-9_\-+.]+))?$/;const CAMEL_CASE_REGEX=/^[a-z][a-zA-Z0-9_\-.]*$/,ID_START_REGEX=/^[a-z]/;exports.assertValidIdentifier=function(value,format="handle"){if("address"!==format){if(!ID_START_REGEX.test(value))throw new Error("Value must start with a lowercase letter.");if("handle"!==format){if("camelCase"!==format);else if(!CAMEL_CASE_REGEX.test(value))throw new Error("Only values with letters, digits, _, -, and . are allowed.")}else if(!exports.HANDLE_REGEX.test(value))throw new Error("Only values with lowercase letters, digits, _, -, and . are allowed.")}else if(!exports.ADDRESS_REGEX.test(value))throw new Error("Value must follow the address format.")},exports.assertNumber=function(value){if(Number.isNaN(value))throw new Error("Please enter a valid number.")},exports.assertGreaterThan=function(value,minValue){if(value<=minValue)throw new Error(`Value must be greater than ${minValue}`)},exports.assertGreaterThanOrEqual=function(value,minValue){if(value<minValue)throw new Error(`Value must be greater than or equal ${minValue}`)},exports.assertLessThanOrEqual=function(value,maxValue){if(value>maxValue)throw new Error(`Value must be less than or equal ${maxValue}`)},exports.assertPowerOf10=function(value){if(Math.log10(value)%1!=0)throw new Error("Value must be a power of 10")},exports.assertValidWithFactor=function(value,factor){if(value*factor%1!=0)throw new Error("Smallest unit of amount can be "+1/factor)},exports.assertOptionsSelected=function(selection,requiredOptions=1){if(!selection||selection.length<requiredOptions)throw new Error(`Please select at least ${requiredOptions} option${requiredOptions>1?"s":""}`)},exports.assertValidUrl=function(url){try{new URL(url)}catch(e){throw new Error(`Value ${url} is not a valid URL.`)}},exports.assertContains=function(value,array){if(!array.includes(value))throw new Error(`Value must be one of ${array.join(", ")}`)}},1276:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.LedgerRecordTestResult=exports.LedgerSdkError=exports.LedgerSdk=exports.WalletsResponse=exports.WalletResponse=exports.SymbolsResponse=exports.SymbolResponse=exports.StatusResponse=exports.SignersResponse=exports.SignerResponse=exports.IntentsResponse=exports.IntentResponse=exports.BridgesResponse=exports.BridgeResponse=void 0;var bridge_client_1=__webpack_require__(1727);Object.defineProperty(exports,"BridgeResponse",{enumerable:!0,get:function(){return bridge_client_1.BridgeResponse}}),Object.defineProperty(exports,"BridgesResponse",{enumerable:!0,get:function(){return bridge_client_1.BridgesResponse}});var intent_client_1=__webpack_require__(7336);Object.defineProperty(exports,"IntentResponse",{enumerable:!0,get:function(){return intent_client_1.IntentResponse}}),Object.defineProperty(exports,"IntentsResponse",{enumerable:!0,get:function(){return intent_client_1.IntentsResponse}});var signer_client_1=__webpack_require__(9390);Object.defineProperty(exports,"SignerResponse",{enumerable:!0,get:function(){return signer_client_1.SignerResponse}}),Object.defineProperty(exports,"SignersResponse",{enumerable:!0,get:function(){return signer_client_1.SignersResponse}});var status_client_1=__webpack_require__(9659);Object.defineProperty(exports,"StatusResponse",{enumerable:!0,get:function(){return status_client_1.StatusResponse}});var symbol_client_1=__webpack_require__(7285);Object.defineProperty(exports,"SymbolResponse",{enumerable:!0,get:function(){return symbol_client_1.SymbolResponse}}),Object.defineProperty(exports,"SymbolsResponse",{enumerable:!0,get:function(){return symbol_client_1.SymbolsResponse}});var wallet_client_1=__webpack_require__(7361);Object.defineProperty(exports,"WalletResponse",{enumerable:!0,get:function(){return wallet_client_1.WalletResponse}}),Object.defineProperty(exports,"WalletsResponse",{enumerable:!0,get:function(){return wallet_client_1.WalletsResponse}});var sdk_1=__webpack_require__(7175);Object.defineProperty(exports,"LedgerSdk",{enumerable:!0,get:function(){return sdk_1.LedgerSdk}});var ledger_sdk_error_1=__webpack_require__(5583);Object.defineProperty(exports,"LedgerSdkError",{enumerable:!0,get:function(){return ledger_sdk_error_1.LedgerSdkError}});var test_result_1=__webpack_require__(3859);Object.defineProperty(exports,"LedgerRecordTestResult",{enumerable:!0,get:function(){return test_result_1.LedgerRecordTestResult}})},1497:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseClient=void 0;const crypto_1=__webpack_require__(8286),lodash_1=__importDefault(__webpack_require__(6517)),ledger_sdk_error_1=__webpack_require__(5583);exports.BaseClient=class BaseClient{constructor(apiClient,defaultAuthParams={}){this.apiClient=apiClient,this.defaultAuthParams=defaultAuthParams}buildRequestHash(requestHashParams){let headers,protectedHeadersSuffix="";Array.isArray(requestHashParams.protectedHeaders)&&(headers=requestHashParams.protectedHeaders.reduce(((_headers,header)=>(protectedHeadersSuffix+=protectedHeadersSuffix?",":":",protectedHeadersSuffix+=header.name.toLowerCase(),Object.assign(_headers,{[header.name]:header.value}))),{}));return`${(0,crypto_1.createHash)({method:requestHashParams.method,url:requestHashParams.url,body:lodash_1.default.isEmpty(requestHashParams.body)?null:requestHashParams.body,headers:lodash_1.default.isEmpty(headers)?null:headers})}${protectedHeadersSuffix}`}async buildJwt(requestHashParams,authParams={}){if(lodash_1.default.isEmpty(!authParams)&&lodash_1.default.isEmpty(this.defaultAuthParams))return null;const params={...this.defaultAuthParams,...this.authParams,...authParams},iat=Math.floor((new Date).getTime()/1e3),jwtPayload={iat,exp:iat+params.exp,iss:params.iss,aud:params.aud,sub:params.sub||params.keyPair.public,jti:params.jti||void 0,hsh:this.buildRequestHash(requestHashParams)};return`Bearer ${await(0,crypto_1.signJWT)(jwtPayload,params.keyPair.secret)}`}async createRecord(path,ResponseClass,record,authParams){try{const token=await this.buildJwt({method:"POST",url:path,body:record,protectedHeaders:[]},authParams);return new ResponseClass(await this.apiClient.post(path,record,{headers:token?{Authorization:token}:{}}))}catch(error){throw new ledger_sdk_error_1.LedgerSdkError(error)}}async updateRecord(path,ResponseClass,record,authParams){try{const token=await this.buildJwt({method:"PUT",url:path,body:record,protectedHeaders:[]},authParams);return new ResponseClass(await this.apiClient.put(path,record,{headers:token?{Authorization:token}:{}}))}catch(error){throw new ledger_sdk_error_1.LedgerSdkError(error)}}async signRecord(path,ResponseClass,signature,authParams){try{const token=await this.buildJwt({method:"POST",url:path,body:signature,protectedHeaders:[]},authParams);return new ResponseClass(await this.apiClient.post(path,signature,{headers:token?{Authorization:token}:{}}))}catch(error){throw new ledger_sdk_error_1.LedgerSdkError(error)}}async getRecord(path,ResponseClass,authParams){try{const token=await this.buildJwt({method:"GET",url:path,body:{},protectedHeaders:[]},authParams);return new ResponseClass(await this.apiClient.get(path,{headers:token?{Authorization:token}:{}}))}catch(error){throw new ledger_sdk_error_1.LedgerSdkError(error)}}async getRecordsList(path,ResponseClass,params){try{const token=await this.buildJwt({method:"GET",url:path,body:{},protectedHeaders:[]},params?.authParams);return new ResponseClass(await this.apiClient.get(path,{params,paramsSerializer:{dots:!0},headers:token?{Authorization:token}:{}}))}catch(error){throw new ledger_sdk_error_1.LedgerSdkError(error)}}setAuthParams(authParams){this.authParams=authParams}}},1727:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.BridgeClient=exports.BridgesResponse=exports.BridgeResponse=void 0;const create_record_builder_1=__webpack_require__(1039),update_record_builder_1=__webpack_require__(477),list_response_1=__webpack_require__(329),record_response_1=__webpack_require__(9735),base_client_1=__webpack_require__(1497);class BridgeResponse extends record_response_1.BaseRecordResponse{constructor(response){super(response),this.bridge=response?.data?.data}}exports.BridgeResponse=BridgeResponse;class BridgesResponse extends list_response_1.BaseListResponse{constructor(response){super(response),this.bridges=response?.data?.data?.map((record=>record.data))}}exports.BridgesResponse=BridgesResponse;class BridgeClient extends base_client_1.BaseClient{init(record){const builder=new create_record_builder_1.CreateRecordBuilder((async(record,authParams)=>this.createRecord("/bridges",BridgeResponse,record,authParams)));return builder.init(record)}from(record){const builder=new update_record_builder_1.UpdateRecordBuilder((async(record,authParams)=>this.updateRecord(`/bridges/${encodeURIComponent(record.data.handle)}`,BridgeResponse,record,authParams)));return builder.init(record)}async read(handle,authParams){return this.getRecord(`/bridges/${encodeURIComponent(handle)}`,BridgeResponse,authParams)}async list(params){return this.getRecordsList("/bridges",BridgesResponse,params)}}exports.BridgeClient=BridgeClient},7341:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.EffectClient=exports.EffectsResponse=exports.EffectResponse=void 0;const create_record_builder_1=__webpack_require__(1039),update_record_builder_1=__webpack_require__(477),list_response_1=__webpack_require__(329),record_response_1=__webpack_require__(9735),base_client_1=__webpack_require__(1497);class EffectResponse extends record_response_1.BaseRecordResponse{constructor(response){super(response),this.effect=response?.data?.data}}exports.EffectResponse=EffectResponse;class EffectsResponse extends list_response_1.BaseListResponse{constructor(response){super(response),this.effects=response?.data?.data?.map((record=>record.data))}}exports.EffectsResponse=EffectsResponse;class EffectClient extends base_client_1.BaseClient{init(record){const builder=new create_record_builder_1.CreateRecordBuilder((async(record,authParams)=>this.createRecord("/effects",EffectResponse,record,authParams)));return builder.init(record)}from(record){const builder=new update_record_builder_1.UpdateRecordBuilder((async(record,authParams)=>this.updateRecord(`/effects/${encodeURIComponent(record.data.handle)}`,EffectResponse,record,authParams)));return builder.init(record)}async read(handle,authParams){return this.getRecord(`/effects/${encodeURIComponent(handle)}`,EffectResponse,authParams)}async list(params){return this.getRecordsList("/effects",EffectsResponse,params)}}exports.EffectClient=EffectClient},6383:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.InstanceClient=exports.InstancesResponse=exports.InstanceResponse=void 0;const create_record_builder_1=__webpack_require__(1039),update_record_builder_1=__webpack_require__(477),list_response_1=__webpack_require__(329),record_response_1=__webpack_require__(9735),base_client_1=__webpack_require__(1497);class InstanceResponse extends record_response_1.BaseRecordResponse{constructor(response){super(response),this.instance=response?.data?.data}}exports.InstanceResponse=InstanceResponse;class InstancesResponse extends list_response_1.BaseListResponse{constructor(response){super(response),this.instances=response?.data?.data?.map((record=>record.data))}}exports.InstancesResponse=InstancesResponse;class InstanceClient extends base_client_1.BaseClient{init(record){const builder=new create_record_builder_1.CreateRecordBuilder((async(record,authParams)=>this.createRecord("/ledgers",InstanceResponse,record,authParams)));return builder.init(record)}from(record){const builder=new update_record_builder_1.UpdateRecordBuilder((async(record,authParams)=>this.updateRecord(`/ledgers/${encodeURIComponent(record.data.handle)}`,InstanceResponse,record,authParams)));return builder.init(record)}async read(handle,authParams){return this.getRecord(`/ledgers/${encodeURIComponent(handle)}`,InstanceResponse,authParams)}async list(params){return this.getRecordsList("/ledgers",InstancesResponse,params)}}exports.InstanceClient=InstanceClient},7336:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.IntentClient=exports.IntentsResponse=exports.IntentResponse=void 0;const sign_intent_builder_1=__webpack_require__(4918),create_record_builder_1=__webpack_require__(1039),list_response_1=__webpack_require__(329),record_response_1=__webpack_require__(9735),base_client_1=__webpack_require__(1497);class IntentResponse extends record_response_1.BaseRecordResponse{constructor(response){super(response),this.intent=response?.data?.data}}exports.IntentResponse=IntentResponse;class IntentsResponse extends list_response_1.BaseListResponse{constructor(response){super(response),this.intents=response?.data?.data?.map((record=>record.data))}}exports.IntentsResponse=IntentsResponse;class IntentClient extends base_client_1.BaseClient{init(record){const builder=new create_record_builder_1.CreateRecordBuilder((async(record,authParams)=>this.createRecord("/intents",IntentResponse,record,authParams)));return builder.init(record)}from(record){return new sign_intent_builder_1.SignIntentBuilder((async(signature,authParams)=>this.signRecord(`/intents/${encodeURIComponent(record.data.handle)}/sign`,IntentResponse,signature,authParams)),record)}async read(handle,authParams){return this.getRecord(`/intents/${encodeURIComponent(handle)}`,IntentResponse,authParams)}async list(params){return this.getRecordsList("/intents",IntentsResponse,params)}}exports.IntentClient=IntentClient},9390:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.SignerClient=exports.SignersResponse=exports.SignerResponse=void 0;const signer_record_builder_1=__webpack_require__(6870),update_record_builder_1=__webpack_require__(477),list_response_1=__webpack_require__(329),record_response_1=__webpack_require__(9735),base_client_1=__webpack_require__(1497);class SignerResponse extends record_response_1.BaseRecordResponse{constructor(response){super(response),this.signer=response?.data?.data}}exports.SignerResponse=SignerResponse;class SignersResponse extends list_response_1.BaseListResponse{constructor(response){super(response),this.signers=response?.data?.data?.map((record=>record.data))}}exports.SignersResponse=SignersResponse;class SignerClient extends base_client_1.BaseClient{init(record){const builder=new signer_record_builder_1.SignerRecordBuilder((async(record,authParams)=>this.createRecord("/signers",SignerResponse,record,authParams)));return builder.init(record)}from(record){const builder=new update_record_builder_1.UpdateRecordBuilder((async(record,authParams)=>this.updateRecord(`/signers/${encodeURIComponent(record.data.handle)}`,SignerResponse,record,authParams)));return builder.init(record)}async read(handle,authParams){return this.getRecord(`/signers/${encodeURIComponent(handle)}`,SignerResponse,authParams)}async list(params){return this.getRecordsList("/signers",SignersResponse,params)}}exports.SignerClient=SignerClient},9659:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.StatusClient=exports.StatusResponse=void 0;const record_response_1=__webpack_require__(9735),base_client_1=__webpack_require__(1497);class StatusResponse extends record_response_1.BaseRecordResponse{constructor(response){super(response),this.status=response?.data?.data}}exports.StatusResponse=StatusResponse;class StatusClient extends base_client_1.BaseClient{async read(){return this.getRecord("",StatusResponse)}init(){return null}}exports.StatusClient=StatusClient},7285:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.SymbolClient=exports.SymbolsResponse=exports.SymbolResponse=void 0;const create_record_builder_1=__webpack_require__(1039),update_record_builder_1=__webpack_require__(477),list_response_1=__webpack_require__(329),record_response_1=__webpack_require__(9735),base_client_1=__webpack_require__(1497);class SymbolResponse extends record_response_1.BaseRecordResponse{constructor(response){super(response),this.symbol=response?.data?.data}}exports.SymbolResponse=SymbolResponse;class SymbolsResponse extends list_response_1.BaseListResponse{constructor(response){super(response),this.symbols=response?.data?.data?.map((record=>record.data))}}exports.SymbolsResponse=SymbolsResponse;class SymbolClient extends base_client_1.BaseClient{init(record){const builder=new create_record_builder_1.CreateRecordBuilder((async(record,authParams)=>this.createRecord("/symbols",SymbolResponse,record,authParams)));return builder.init(record)}from(record){const builder=new update_record_builder_1.UpdateRecordBuilder((async(record,authParams)=>this.updateRecord(`/symbols/${encodeURIComponent(record.data.handle)}`,SymbolResponse,record,authParams)));return builder.init(record)}async read(handle,authParams){return this.getRecord(`/symbols/${encodeURIComponent(handle)}`,SymbolResponse,authParams)}async list(params){return this.getRecordsList("/symbols",SymbolsResponse,params)}}exports.SymbolClient=SymbolClient},7361:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.WalletClient=exports.BalancesResponse=exports.WalletsResponse=exports.WalletResponse=void 0;const create_record_builder_1=__webpack_require__(1039),update_record_builder_1=__webpack_require__(477),list_response_1=__webpack_require__(329),record_response_1=__webpack_require__(9735),base_client_1=__webpack_require__(1497);class WalletResponse extends record_response_1.BaseRecordResponse{constructor(response){super(response),this.wallet=response?.data?.data}}exports.WalletResponse=WalletResponse;class WalletsResponse extends list_response_1.BaseListResponse{constructor(response){super(response),this.wallets=response?.data?.data?.map((record=>record.data))}}exports.WalletsResponse=WalletsResponse;class BalancesResponse extends list_response_1.BaseListResponse{constructor(response){super(response),this.balances=response?.data?.data?.map((record=>record.data))}}exports.BalancesResponse=BalancesResponse;class WalletClient extends base_client_1.BaseClient{init(record){const builder=new create_record_builder_1.CreateRecordBuilder((async(record,authParams)=>this.createRecord("/wallets",WalletResponse,record,authParams)));return builder.init(record)}from(record){const builder=new update_record_builder_1.UpdateRecordBuilder((async(record,authParams)=>this.updateRecord(`/wallets/${encodeURIComponent(record.data.handle)}`,WalletResponse,record,authParams)));return builder.init(record)}async read(handle,authParams){return this.getRecord(`/wallets/${encodeURIComponent(handle)}`,WalletResponse,authParams)}async list(params){return this.getRecordsList("/wallets",WalletsResponse,params)}async getBalances(handle,params){return this.getRecordsList(`/wallets/${encodeURIComponent(handle)}/balances`,BalancesResponse,params)}}exports.WalletClient=WalletClient},7175:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.LedgerSdk=void 0;const axios_1=__importDefault(__webpack_require__(2167)),nanoid_1=__webpack_require__(754),effect_client_1=__webpack_require__(7341),instance_client_1=__webpack_require__(6383),intent_client_1=__webpack_require__(7336),signer_client_1=__webpack_require__(9390),status_client_1=__webpack_require__(9659),symbol_client_1=__webpack_require__(7285),wallet_client_1=__webpack_require__(7361),bridge_client_1=__webpack_require__(1727);exports.LedgerSdk=class LedgerSdk{constructor(options){if(options.url.endsWith("/"))throw new Error(`Base URL shouldn't have a trailing slash: ${options.url}`);const apiClient=axios_1.default.create({baseURL:options.url,timeout:options.timeout||15e3});this.statusClient=new status_client_1.StatusClient(apiClient),this.instance=new instance_client_1.InstanceClient(apiClient,options.defaultAuthParams),this.symbol=new symbol_client_1.SymbolClient(apiClient,options.defaultAuthParams),this.wallet=new wallet_client_1.WalletClient(apiClient,options.defaultAuthParams),this.intent=new intent_client_1.IntentClient(apiClient,options.defaultAuthParams),this.signer=new signer_client_1.SignerClient(apiClient,options.defaultAuthParams),this.effect=new effect_client_1.EffectClient(apiClient,options.defaultAuthParams),this.bridge=new bridge_client_1.BridgeClient(apiClient,options.defaultAuthParams),this.handle={unique:(size=17)=>(0,nanoid_1.nanoid)(size)}}async setAuthParams(authParams){this.instance.setAuthParams(authParams),this.symbol.setAuthParams(authParams),this.wallet.setAuthParams(authParams),this.intent.setAuthParams(authParams),this.signer.setAuthParams(authParams),this.effect.setAuthParams(authParams),this.bridge.setAuthParams(authParams)}async status(){return this.statusClient.read()}}},2266:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseRecordBuilder=void 0;const crypto_1=__webpack_require__(8286),ledger_sdk_error_1=__webpack_require__(5583),test_result_1=__webpack_require__(3859);exports.BaseRecordBuilder=class BaseRecordBuilder{enqueueAsyncOperation(operation){this.pendingAsyncOperations?this.pendingAsyncOperations=this.pendingAsyncOperations.then((()=>operation())):this.pendingAsyncOperations=operation()}async finishAsyncOperations(){this.pendingAsyncOperations&&await this.pendingAsyncOperations}init(record){return this.enqueueAsyncOperation((async()=>{this.record={hash:record?.hash||"",data:record?.data||{},meta:record?.meta||{signatures:[]}},this.record.meta.signatures||(this.record.meta.signatures=[])})),this}data(data){return this.enqueueAsyncOperation((async()=>{Object.assign(this.record.data,data)})),this}meta(meta){return this.enqueueAsyncOperation((async()=>{Object.assign(this.record.meta,meta)})),this}hash(hash){return this.enqueueAsyncOperation((async()=>{this.record.hash=hash||(0,crypto_1.createHash)(this.record.data)})),this}auth(params){return this.enqueueAsyncOperation((async()=>{Object.assign(this.authParams,params)})),this}sign(params){return this.enqueueAsyncOperation((async()=>{const hash=this.record.hash;if(!hash)throw new Error("Invalid record hash, set a hash by calling '.hash()' before attempting to sign a record.");for(const p of params){const signature=await(0,crypto_1.signHash)(hash,p.keyPair,p.custom);p.custom&&(signature.custom=p.custom),this.record.meta.signatures.push(signature)}})),this}async read(){try{return await this.finishAsyncOperations(),this.record}catch(error){throw new ledger_sdk_error_1.LedgerSdkError(error)}}async test(){try{await this.finishAsyncOperations();const results=[],hash=(0,crypto_1.createHash)(this.record.data);this.record?.hash!==hash?results.push(new test_result_1.LedgerRecordTestResult("invalid-hash",`Expected a hash value of '${hash}', but found '${this.record?.hash}'`)):results.push(new test_result_1.LedgerRecordTestResult("verified-hash",`Hash value '${hash} is valid'`));const signatures=this.record?.meta?.signatures;signatures||results.push(new test_result_1.LedgerRecordTestResult("no-signatures","No signatures found in 'meta.signatures'"));for(const signature of signatures){await(0,crypto_1.verifySignature)(hash,signature)?results.push(new test_result_1.LedgerRecordTestResult("verified-signature",`Signature with public key ${signature.public} is valid`)):results.push(new test_result_1.LedgerRecordTestResult("invalid-signature",`Signature with public key '${signature.public}' is invalid`))}return results}catch(error){throw new ledger_sdk_error_1.LedgerSdkError(error)}}}},1039:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateRecordBuilder=void 0;const ledger_sdk_error_1=__webpack_require__(5583),base_record_builder_1=__webpack_require__(2266);class CreateRecordBuilder extends base_record_builder_1.BaseRecordBuilder{constructor(createRecord){super(),this.createRecord=createRecord}async send(){try{return await this.finishAsyncOperations(),this.createRecord(this.record,this.authParams)}catch(error){throw new ledger_sdk_error_1.LedgerSdkError(error)}}}exports.CreateRecordBuilder=CreateRecordBuilder},4918:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.SignIntentBuilder=void 0;const ledger_sdk_error_1=__webpack_require__(5583),base_record_builder_1=__webpack_require__(2266);exports.SignIntentBuilder=class SignIntentBuilder{constructor(sendSignature,intent){this.recordBuilder=new base_record_builder_1.BaseRecordBuilder,this.recordBuilder.init(intent),this.sendSignature=sendSignature,this.newSignaturesStartIndex=intent.meta?.signatures?.length||0}auth(params){return Object.assign(this.authParams,params),this}async read(){return this.recordBuilder.read()}hash(hash){return this.recordBuilder.hash(hash),this}sign(params){return this.recordBuilder.sign(params),this}async send(){try{const signatures=(await this.recordBuilder.read())?.meta?.signatures?.slice(this.newSignaturesStartIndex)||[];if(0===signatures.length)throw new Error("Unable to send signatures, no signatures found!");let result=null;for(let i=0;i<signatures.length;i++)result=await this.sendSignature(signatures[i],this.authParams);return result}catch(error){throw new ledger_sdk_error_1.LedgerSdkError(error)}}async test(){return this.recordBuilder.test()}}},6870:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.SignerRecordBuilder=void 0;const crypto_1=__webpack_require__(8286),types_1=__webpack_require__(8071),create_record_builder_1=__webpack_require__(1039);class SignerRecordBuilder extends create_record_builder_1.CreateRecordBuilder{async decryptSecret(secret){if(!this.password)throw new Error("Unable to decrypt secret without password, use '.code(password)' before calling '.keys()'");return(0,crypto_1.decryptSecretKey)(secret,this.password)}async extractKeyPair(){if(!this.record.data.schema||!this.record.data.public||!this.record.data.secret)throw new Error("Incomplete key pair in signer record, use '.data({ schema, public, secret })' or '.init()' before calling '.lock()' or '.keys()'");const secret=(0,crypto_1.isSecretKeyEncrypted)(this.record.data.secret)?await this.decryptSecret(this.record.data.secret):this.record.data.secret;return{schema:this.record.data.schema,public:this.record.data.public,secret}}code(password){return this.enqueueAsyncOperation((async()=>{this.password=password,this.record.data.secret&&!(0,crypto_1.isSecretKeyEncrypted)(this.record.data.secret)&&(this.record.data.secret=await(0,crypto_1.encryptSecretKey)(this.record.data.secret,password))})),this}lock(){return this.enqueueAsyncOperation((async()=>{const hash=this.record.hash;if(!hash)throw new Error("Invalid record hash, set a hash by calling '.hash()' before attempting to lock a record.");const keyPair=await this.extractKeyPair();this.record.meta.signatures.push(await(0,crypto_1.signHash)(hash,keyPair))})),this}async read(readOptions){const record=Object.assign({},await super.read()),{data}=record;if(readOptions?.plain&&data.secret&&(0,crypto_1.isSecretKeyEncrypted)(data.secret)){if(!this.password)throw new Error("Unable to decrypt secret without password, use '.code(password)' before calling '.keys()'");data.secret=await(0,crypto_1.decryptSecretKey)(data.secret,this.password)}return record}keys(keyPair){return this.enqueueAsyncOperation((async()=>{if(!keyPair.schema||!crypto_1.SUPPORTED_KEY_SCHEMAS.includes(keyPair.schema))throw new Error("Key schema not supported.");keyPair.public&&keyPair.secret||(keyPair=await(0,crypto_1.createKeyPair)()),this.record.data.public=keyPair.public,this.record.data.schema=keyPair.schema,this.record.data.secret=keyPair.secret,this.record.data.access=this.record.data.access||[{action:types_1.AccessAction.Any,signer:keyPair.public}]})),this}}exports.SignerRecordBuilder=SignerRecordBuilder},477:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.UpdateRecordBuilder=void 0;const lodash_1=__webpack_require__(6517),ledger_sdk_error_1=__webpack_require__(5583),base_record_builder_1=__webpack_require__(2266);class UpdateRecordBuilder extends base_record_builder_1.BaseRecordBuilder{constructor(updateRecord){super(),this.updateRecord=updateRecord}init(record){const recordClone=(0,lodash_1.cloneDeep)(record);return(0,lodash_1.set)(recordClone,"meta.signatures",[]),super.init(recordClone),this}data(data,replace=!1){return this.enqueueAsyncOperation((async()=>{if(replace)(0,lodash_1.set)(this.record,"data",data);else{let clonedData=(0,lodash_1.cloneDeep)(this.record.data);clonedData=(0,lodash_1.merge)(clonedData,data),clonedData=this.deepRemoveNull(clonedData),(0,lodash_1.set)(this.record,"data",clonedData)}})),this}deepRemoveNull(object){if(!(0,lodash_1.isObject)(object))return object;const wasArray=(0,lodash_1.isArray)(object),clear=Object.entries(object).filter((([,value])=>!1===(0,lodash_1.isNil)(value))).reduce(((r,[key,value])=>({...r,[key]:this.deepRemoveNull(value)})),{});return wasArray?Object.values(clear):clear}async send(){try{return await this.finishAsyncOperations(),this.updateRecord(this.record,this.authParams)}catch(error){throw new ledger_sdk_error_1.LedgerSdkError(error)}}}exports.UpdateRecordBuilder=UpdateRecordBuilder},5583:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.LedgerSdkError=void 0;const axios_1=__webpack_require__(2167),lodash_1=__importDefault(__webpack_require__(6517));class LedgerSdkError extends Error{constructor(causedBy){if(causedBy instanceof LedgerSdkError)return causedBy;if(super(),this.name="LedgerApiError",this.detail={},causedBy instanceof axios_1.AxiosError){const responseBody=causedBy.response?.data;responseBody?.data?.status?(this.status=responseBody.data.status,this.reason=responseBody.data.reason||"No reason provided",this.detail=responseBody.data.detail||{}):(this.status="unexpected-server-error",this.reason=causedBy.message||"Unexpected server error occurred!",this.detail={body:responseBody})}else this.status="unexpected-client-error",this.reason=causedBy.message;this.detail.causedBy=causedBy,this.message=this.reason}toJSON(){return lodash_1.default.merge({},this,{detail:{causedBy:null}})}}exports.LedgerSdkError=LedgerSdkError},329:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseListResponse=void 0;exports.BaseListResponse=class BaseListResponse{constructor(response){this.response=response,this.hash=response?.data?.hash,this.meta=response?.data?.meta,this.page=response?.data?.page}}},9735:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseRecordResponse=void 0;exports.BaseRecordResponse=class BaseRecordResponse{constructor(response){this.response=response,this.hash=response?.data?.hash,this.meta=response?.data?.meta}}},3859:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.LedgerRecordTestResult=void 0;exports.LedgerRecordTestResult=class LedgerRecordTestResult{constructor(status,detail,moment,client){this.status=status,this.detail=detail,this.moment=moment||(new Date).toISOString(),this.client=client||"ledger-sdk-js"}}},8071:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&!("get"in desc?!m.__esModule:desc.writable||desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)"default"===p||Object.prototype.hasOwnProperty.call(exports,p)||__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(__webpack_require__(4231),exports),__exportStar(__webpack_require__(230),exports),__exportStar(__webpack_require__(2565),exports),__exportStar(__webpack_require__(8035),exports),__exportStar(__webpack_require__(5585),exports),__exportStar(__webpack_require__(1147),exports),__exportStar(__webpack_require__(7479),exports),__exportStar(__webpack_require__(5797),exports),__exportStar(__webpack_require__(3297),exports),__exportStar(__webpack_require__(2080),exports),__exportStar(__webpack_require__(8777),exports),__exportStar(__webpack_require__(230),exports),__exportStar(__webpack_require__(1721),exports),__exportStar(__webpack_require__(4301),exports),__exportStar(__webpack_require__(4558),exports),__exportStar(__webpack_require__(7631),exports),__exportStar(__webpack_require__(7452),exports),__exportStar(__webpack_require__(7117),exports),__exportStar(__webpack_require__(8031),exports),__exportStar(__webpack_require__(7760),exports),__exportStar(__webpack_require__(5735),exports),__exportStar(__webpack_require__(5522),exports)},4231:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},230:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},2565:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},8035:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},5585:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AccessAction=exports.AccessRecord=exports.SignerKeyword=void 0,function(SignerKeyword){SignerKeyword.LedgerSigner="$signer",SignerKeyword.AnySigner="*"}(exports.SignerKeyword||(exports.SignerKeyword={})),function(AccessRecord){AccessRecord.Any="any",AccessRecord.Server="server",AccessRecord.Ledger="ledger",AccessRecord.Signer="signer",AccessRecord.Symbol="symbol",AccessRecord.Wallet="wallet",AccessRecord.Intent="intent",AccessRecord.Effect="effect",AccessRecord.Bridge="bridge"}(exports.AccessRecord||(exports.AccessRecord={})),function(AccessAction){AccessAction.Any="any",AccessAction.Access="access",AccessAction.Create="create",AccessAction.Read="read",AccessAction.Update="update"}(exports.AccessAction||(exports.AccessAction={}))},1147:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},7479:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},8777:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},5797:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},3297:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},2080:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},1721:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},4301:(__unused_webpack_module,exports)=>{var BridgeSchema;Object.defineProperty(exports,"__esModule",{value:!0}),exports.BridgeSchemas=exports.BridgeSchema=void 0,function(BridgeSchema){BridgeSchema.Rest="rest"}(BridgeSchema=exports.BridgeSchema||(exports.BridgeSchema={})),exports.BridgeSchemas=Object.values(BridgeSchema)},4558:(__unused_webpack_module,exports)=>{var EffectActionSchema;Object.defineProperty(exports,"__esModule",{value:!0}),exports.EffectActionSchemas=exports.EffectActionSchema=void 0,function(EffectActionSchema){EffectActionSchema.webhook="webhook"}(EffectActionSchema=exports.EffectActionSchema||(exports.EffectActionSchema={})),exports.EffectActionSchemas=Object.values(EffectActionSchema)},7631:(__unused_webpack_module,exports)=>{var EventSignal;Object.defineProperty(exports,"__esModule",{value:!0}),exports.EventSignals=exports.EventSignal=void 0,function(EventSignal){EventSignal.BalanceReceived="balance-received",EventSignal.EffectCreated="effect-created",EventSignal.LedgerCreated="ledger-created",EventSignal.IntentCreated="intent-created",EventSignal.SignerCreated="signer-created",EventSignal.SymbolCreated="symbol-created",EventSignal.WalletCreated="wallet-created",EventSignal.BridgeCreated="bridge-created",EventSignal.EffectUpdated="effect-updated",EventSignal.LedgerUpdated="ledger-updated",EventSignal.IntentUpdated="intent-updated",EventSignal.SignerUpdated="signer-updated",EventSignal.SymbolUpdated="symbol-updated",EventSignal.WalletUpdated="wallet-updated",EventSignal.BridgeUpdated="bridge-updated"}(EventSignal=exports.EventSignal||(exports.EventSignal={})),exports.EventSignals=Object.values(EventSignal)},7452:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},7117:(__unused_webpack_module,exports)=>{var ClaimAction;Object.defineProperty(exports,"__esModule",{value:!0}),exports.ClaimActions=exports.ClaimAction=exports.IntentStatus=void 0,function(IntentStatus){IntentStatus.Pending="pending",IntentStatus.Committed="committed",IntentStatus.Completed="completed",IntentStatus.Aborted="aborted",IntentStatus.Rejected="rejected"}(exports.IntentStatus||(exports.IntentStatus={})),function(ClaimAction){ClaimAction.Issue="issue",ClaimAction.Transfer="transfer",ClaimAction.Destroy="destroy"}(ClaimAction=exports.ClaimAction||(exports.ClaimAction={})),exports.ClaimActions=Object.values(ClaimAction)},8031:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},7760:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},5735:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},5522:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.WalletRouteAction=void 0,function(WalletRouteAction){WalletRouteAction.Forward="forward",WalletRouteAction.Accept="accept"}(exports.WalletRouteAction||(exports.WalletRouteAction={}))},599:module=>{module.exports=require("@noble/ed25519")},2167:module=>{module.exports=require("axios")},5022:module=>{module.exports=require("chalk")},7304:module=>{module.exports=require("commander")},7805:module=>{module.exports=require("detect-node")},6860:module=>{module.exports=require("express")},4470:module=>{module.exports=require("fs-extra")},3290:module=>{module.exports=require("inquirer")},8506:module=>{module.exports=require("joi")},1567:module=>{module.exports=require("jose")},6517:module=>{module.exports=require("lodash")},754:module=>{module.exports=require("nanoid")},732:module=>{module.exports=require("ngrok")},8730:module=>{module.exports=require("safe-stable-stringify")},700:module=>{module.exports=require("string-width")},1354:module=>{module.exports=require("table")},6113:module=>{module.exports=require("crypto")},2037:module=>{module.exports=require("os")},3837:module=>{module.exports=require("util")},6984:module=>{module.exports=JSON.parse('{"name":"@minka/cli","version":"1.3.0","description":"Command line tool for Minka Ledger","main":"main.js","bin":{"minka":"main.js"},"scripts":{"test":"jest"},"keywords":["minka","ledger","cli"],"author":"Željko Rumenjak","license":"UNLICENSED"}')}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.exports}var __webpack_exports__={};(()=>{var exports=__webpack_exports__;Object.defineProperty(exports,"__esModule",{value:!0});const commander_1=__webpack_require__(7304),bridge_create_1=__webpack_require__(1859),bridge_start_1=__webpack_require__(9273),effect_create_1=__webpack_require__(5400),intent_create_1=__webpack_require__(2920),intent_list_1=__webpack_require__(6853),intent_show_1=__webpack_require__(9684),ledger_create_1=__webpack_require__(3789),ledger_login_1=__webpack_require__(9151),ledger_logout_1=__webpack_require__(6557),ledger_show_1=__webpack_require__(8570),server_connect_1=__webpack_require__(8449),server_show_1=__webpack_require__(7616),signer_create_1=__webpack_require__(5262),symbol_create_1=__webpack_require__(7367),wallet_balances_1=__webpack_require__(4216),wallet_create_1=__webpack_require__(350),wallet_list_1=__webpack_require__(7544),wallet_show_1=__webpack_require__(2921),wallet_update_1=__webpack_require__(1900),error_handling_1=__webpack_require__(6418),package_json_1=__webpack_require__(6984);commander_1.program.name("minka").version(package_json_1.version),commander_1.program.addOption(new commander_1.Option("-v, --verbose","print more detailed output")),commander_1.program.addOption(new commander_1.Option("-t, --trace","prints even more details than verbose").implies({verbose:!0})),commander_1.program.on("option:verbose",(()=>{process.env.VERBOSE=commander_1.program.opts().verbose})),commander_1.program.on("option:trace",(()=>{process.env.TRACE=commander_1.program.opts().trace})),commander_1.program.command("server").description("manage server connections").command("show").description("show the remote connection status").action(server_show_1.showServer).parent.command("connect").description("connect to a remote server").action(server_connect_1.connectToServer),commander_1.program.command("ledger").description("create and manage ledger instances").command("show").description("show active ledger details").action(ledger_show_1.showLedger).parent.command("create").description("create a ledger instance").action(ledger_create_1.createLedgerInstance).parent.command("login").description("login as a signer to enable authentication through JWT to ledger").action(ledger_login_1.ledgerLogin).parent.command("logout").description("logout as a signer to stop sending authenticated JWT to ledger").action(ledger_logout_1.ledgerLogout),commander_1.program.command("signer").description("create and manage signing keys").command("create").description("create a new key pair for signing requests").action(signer_create_1.createSigner),commander_1.program.command("symbol").description("create and manage symbols").command("create").description("create a new symbol").action(symbol_create_1.createSymbol),commander_1.program.command("wallet").description("create and manage wallets").command("create").description("create a new wallet").action(wallet_create_1.createWallet).parent.command("show <handle>").description("show single wallet details").action(wallet_show_1.showWallet).parent.command("list").description("list wallets").option("-p, --page <index>","page index to load, zero based","0").option("-l, --limit <limit>","max number of items per page","10").action(wallet_list_1.showWalletList).parent.command("balances <handle>").description("show wallet balances").action(wallet_balances_1.getWalletBalances).parent.command("update <handle>").description("update wallet details").option("-e, --editor","edit raw JSON using an external editor").action(wallet_update_1.updateWallet),commander_1.program.command("intent").description("create intents to transfer balances").command("create").description("create a new intent").action(intent_create_1.createIntent).parent.command("show <handle>").description("show single intent details").action(intent_show_1.showIntent).parent.command("list").description("list intents").option("-p, --page <index>","page index to load, zero based","0").option("-l, --limit <limit>","max number of items per page","10").action(intent_list_1.showIntentList),commander_1.program.command("effect").description("create and manage effects").command("create").description("create a new effect").action(effect_create_1.createEffect),commander_1.program.command("bridge").description("create and manage bridges").command("start").description("create a local bridge for testing").option("-p, --port <port>","local port to use","4042").action(bridge_start_1.startBridge).parent.command("create").description("create a new bridge").action(bridge_create_1.createBridge),commander_1.program.parseAsync(process.argv).catch((error=>{(0,error_handling_1.printError)(error)}))})();var __webpack_export_target__=exports;for(var i in __webpack_exports__)__webpack_export_target__[i]=__webpack_exports__[i];__webpack_exports__.__esModule&&Object.defineProperty(__webpack_export_target__,"__esModule",{value:!0})})();